{
  "hash": "923ab9815af574e94274aaaaa46a2f1e",
  "result": {
    "markdown": "---\ntitle: How to arrange ggplot2 panel plots\ndescription: |\n  Arrange your visual display of information to maximize your figures' impact.\ndate: 2016-12-06\ncategories:\n  - data science\n  - R\n  - visualization\nbibliography: bibliography.bib\nimage: \"index_files/figure-html/image1-1.png\"\n---\n\n\n\n\n\n\nPanel plots are a common name for figures showing every person's (or whatever your sampling unit is) data in their own panel. This plot is sometimes also known as \"small multiples\", although that more commonly refers to plots that illustrate interactions. Here, I'll illustrate how to add information to a panel plot by arranging the panels according to some meaningful value.\n\nHere's an example of a panel plot, using the `sleepstudy` data set from the **lme4** package.\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/packages_2802963cf0a15e6886e81041cbefff9f'}\n\n```{.r .cell-code}\nlibrary(knitr)\nlibrary(scales)\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/image1_a95196f800632ee61020c211b0a6ca35'}\n\n```{.r .cell-code}\ndata(sleepstudy, package = \"lme4\")\nggplot(sleepstudy, aes(x = Days, y = Reaction)) +\n  geom_point() +\n  scale_x_continuous(breaks = 0:9) +\n  facet_wrap(\"Subject\", labeller = label_both)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/image1-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nOn the x-axis is days of sleep deprivation, and y-axis is an aggregate measure of reaction time across a number of cognitive tasks. Reaction time increases as a function of sleep deprivation. But the order of the panels is entirely uninformative, they are simply arranged in increasing order of subject ID number, from top left to bottom right. Subject ID numbers are rarely informative, and we would therefore like to order the panels according to some other fact about the individual participants. \n\n# Order panels on mean value\n\nLet's start by ordering the panels on the participants' mean reaction time, with the fastest participant in the upper-left panel.\n\nStep 1 is to add the required information to the data frame used in plotting. For a simple mean, we can actually use a shortcut in step 2, so this isn't required.\n\nStep 2: Convert the variable used to separate the panels into a factor, and order it based on the mean reaction time. \n\nThe key here is to use the `reorder()` function. You'll first enter the variable that contains the groupings (i.e. the subject ID numbers), and then values that will be used to order the grouping variables. Finally, here you can use a shortcut to base the ordering on a function of the values, such as the mean, by entering it as the third argument.\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-1_dd03fbb642cbaa682ab449fa00e28297'}\n\n```{.r .cell-code}\nsleepstudy <- mutate(\n  sleepstudy,\n  Subject = reorder(Subject, Reaction, mean)\n)\n```\n:::\n\n\nNow if we use `Subject` to create the subplots, they will be ordered on the mean reaction time. I'll make the illustration clear by also drawing the person-means with small arrows.\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-2_3ea1d9452492798e34e9c1dd4e4e3f3c'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n# Order panels on other parameters\n\nIt might also be useful to order the panels based on a value from a model, such as the slope of a linear regression. This is especially useful in making the heterogeneity in the sample easier to see. For this, you'll need to fit a model, grab the subject-specific slopes, order the paneling factor, and plot. I'll illustrate with a multilevel regression using **lme4**.\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-3_3459c861c71cdd06220088f192f6fffd'}\n\n```{.r .cell-code}\n# Step 1: Add values to order on into the data frame\nlibrary(lme4)\nmod <- lmer(Reaction ~ Days + (Days | Subject), data = sleepstudy)\n# Create a data frame with subject IDs and coefficients\ncoefs <- coef(mod)$Subject %>%\n  rownames_to_column(\"Subject\")\nnames(coefs) <- c(\"Subject\", \"Intercept\", \"Slope\")\n# Join to main data frame by Subject ID\nsleepstudy <- left_join(sleepstudy, coefs, by = \"Subject\")\n\n# Step 2: Reorder the grouping factor\nsleepstudy <- mutate(\n  sleepstudy,\n  Subject = reorder(Subject, Slope)\n)\n```\n:::\n\n\nThen, I'll plot the data also showing the fitted lines from the multilevel model:\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-4_253dea3c6adcfe0f1fc49531668cd936'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nHopefully you'll find this helpful. \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}