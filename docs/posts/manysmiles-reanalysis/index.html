<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.339">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matti Vuorre">
<meta name="dcterms.date" content="2022-11-20">

<title>Matti’s homepage - ManySmiles reanalysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    null
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script data-goatcounter="https://vuorre.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta property="og:title" content="Matti’s homepage - ManySmiles reanalysis">
<meta property="og:description" content="Do people’s facial expressions influence their own emotions? In the ManySmiles collaboration, ~50 researchers from 19 countries worked together to find out. In this pedagogical example, I reanalyse the ManySmiles dataset by estimating incrementally more plausible models to investigate their finding’s robustness to various modelling choices. Overall, I suggest that large multilab projects, which presumably have some resources and human work hours to spare, should investigate the analytic robustness of their statistical analyses more carefully.">
<meta property="og:image" content="">
<meta property="og:site_name" content="Matti's homepage">
<meta name="twitter:title" content="Matti’s homepage - ManySmiles reanalysis">
<meta name="twitter:description" content="Do people’s facial expressions influence their own emotions? In the ManySmiles collaboration, ~50 researchers from 19 countries worked together to find out. In this pedagogical example, I reanalyse the ManySmiles dataset by estimating incrementally more plausible models to investigate their finding’s robustness to various modelling choices. Overall, I suggest that large multilab projects, which presumably have some resources and human work hours to spare, should investigate the analytic robustness of their statistical analyses more carefully.">
<meta name="twitter:image" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Matti’s homepage</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../personal.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-links" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Links</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-links">    
        <li>
    <a class="dropdown-item" href="../../blog.xml">
 <span class="dropdown-text">RSS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="mailto:m.j.vuorre@tilburguniversity.edu">
 <span class="dropdown-text">Email</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://orcid.org/0000-0001-5052-066X">
 <span class="dropdown-text">ORCID</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bayes.club/(matti?)">
 <span class="dropdown-text">Mastodon</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/mvuorre">
 <span class="dropdown-text">GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/mvuorre/CV/raw/main/vuorre-matti.pdf">
 <span class="dropdown-text">CV</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://twitter.com/vuorre">
 <span class="dropdown-text">Twitter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.linkedin.com/in/matti-vuorre">
 <span class="dropdown-text">LinkedIn</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.buymeacoffee.com/vuorre">
 <span class="dropdown-text">Buy me a coffee</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">ManySmiles reanalysis</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">modelling</div>
                <div class="quarto-category">bayes</div>
                <div class="quarto-category">stan</div>
                <div class="quarto-category">brms</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://vuorre.netlify.app">Matti Vuorre</a> <a href="https://orcid.org/0000-0001-5052-066X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://www.tilburguniversity.edu/staff/m-j-vuorre">
              Tilburg University
              </a>
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2022-11-20</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      Do people’s facial expressions influence their own emotions? In the ManySmiles collaboration, ~50 researchers from 19 countries worked together to find out. In this pedagogical example, I reanalyse the ManySmiles dataset by estimating incrementally more plausible models to investigate their finding’s robustness to various modelling choices. Overall, I suggest that large multilab projects, which presumably have some resources and human work hours to spare, should investigate the analytic robustness of their statistical analyses more carefully.
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#original-analysis" id="toc-original-analysis" class="nav-link" data-scroll-target="#original-analysis">Original analysis</a></li>
  <li><a href="#reanalysis-1-gaussian-models" id="toc-reanalysis-1-gaussian-models" class="nav-link" data-scroll-target="#reanalysis-1-gaussian-models">Reanalysis 1: Gaussian models</a>
  <ul class="collapse">
  <li><a href="#bayesian-estimation" id="toc-bayesian-estimation" class="nav-link" data-scroll-target="#bayesian-estimation">1. Bayesian estimation</a></li>
  <li><a href="#constant-variance" id="toc-constant-variance" class="nav-link" data-scroll-target="#constant-variance">2. Constant variance</a></li>
  <li><a href="#varying-items" id="toc-varying-items" class="nav-link" data-scroll-target="#varying-items">3. Varying items</a></li>
  </ul></li>
  <li><a href="#reanalysis-2-ordinal-models" id="toc-reanalysis-2-ordinal-models" class="nav-link" data-scroll-target="#reanalysis-2-ordinal-models">Reanalysis 2: Ordinal models</a></li>
  <li><a href="#effect-size" id="toc-effect-size" class="nav-link" data-scroll-target="#effect-size">Effect size</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  
  
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>According to the <em>Facial Feedback Hypothesis</em>, people’s facial expressions influence how they feel. In a well-known study of this idea, subjects held a pen in their mouth so as to induce smiles without explicitly attempting to smile <span class="citation" data-cites="strackInhibitingFacilitatingConditions1988">(<a href="#ref-strackInhibitingFacilitatingConditions1988" role="doc-biblioref">Strack, Martin, and Stepper 1988</a>)</span>. When participants held a pen in their mouths, they found cartoons funnier than when they did not have a pen in their mouths, thus suggesting that this “unintended smile” made people more joyous.</p>
<p>Since then, people have found this idea both interesting and difficult to replicate. One registered report with 17 independent replications found an average treatment effect of pen-in-mouth on funniness ratings of 0.03 [-0.11, 0.16]<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> units on a 10-point Likert item, versus the original study that reported an effect of 0.82 <span class="citation" data-cites="wagenmakersRegisteredReplicationReport2016">(<a href="#ref-wagenmakersRegisteredReplicationReport2016" role="doc-biblioref">Wagenmakers et al. 2016</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;I report all estimates as frequentist point estimates and 95% confidence intervals or bayesian posterior means and 95% actual confidence intervals.</p></li></div><p>To alleviate the resulting confusion, a new adversarial collaboration—a study conducted jointly by researchers who believe in the facial feedback hypothesis and people who don’t—with researchers from 19 countries did some more replicating <span class="citation" data-cites="colesMultilabTestFacial2022">(<a href="#ref-colesMultilabTestFacial2022" role="doc-biblioref">Coles et al. 2022</a>)</span>.</p>
<p>In this multi-lab study, participants rated their happiness across four dimensions—happiness, enjoyment, liking, and satisfaction—under different conditions. Using 1,504 participants’ data<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, the authors reported that 1. posing happy vs.&nbsp;neutral expressions led to higher happiness ratings, and 2. happy poses led to greater happiness ratings when participants mimicked or voluntarily changed their facial pose, but not when they had a pen stuck in their mouths. If True, the facial feedback hypothesis suggests that people’s lives could be improved (made happier, at least) by having them do a brief happy pose every morning. (Hey, maybe that works? I don’t know. <a href="https://en.wikipedia.org/wiki/Further_research_is_needed">MRIS</a>.)</p>
<div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;The initial sample size was 3,878, but most participants were excluded from this main analysis because they guessed what the study was about and thus might have trolled the researchers.</p></li></div><p>Even though these replication experiments have dozens on people working on such consequential ideas, I find (on skimming the reports) it surprising that relatively little effort is spent on how the data are analysed. Since data from these modern efforts are openly available, my goal in this write-up is to examine whether the results in <span class="citation" data-cites="colesMultilabTestFacial2022">(<a href="#ref-colesMultilabTestFacial2022" role="doc-biblioref">Coles et al. 2022</a>)</span> are robust to other, more plausible, modelling strategies. My complementary purpose for this entry is to illustrate some fundamentals of incremental model building in a tutorial-like fashion.</p>
</section>
<section id="original-analysis" class="level1">
<h1>Original analysis</h1>
<p>The multi-lab experiment included three manipulated variables in a fully crossed design: <strong>Pose</strong> (whether participants were supposed to pose a happy or a neutral expression); <strong>Task</strong> (participants either mimicked an expression, voluntarily performed the expression, or pen-in-mouthed the expression); and <strong>Picture</strong> (absence vs.&nbsp;presence of a positive picture). Pose was manipulated within-subjects with no repetitions, while Task and Picture were between-subject manipulations.</p>
<p>After performing each pose, participants completed <em>“the Discrete Emotions Questionnaire’s four-item happiness subscale, which asked the participants to indicate the degree to which they experienced happiness, satisfaction, liking and enjoyment during the preceding task (1 = ‘not at all’ to 7 = ‘an extreme amount’)”</em> (p.&nbsp;8) <span class="citation" data-cites="harmon-jonesDiscreteEmotionsQuestionnaire2016">(see <a href="#ref-harmon-jonesDiscreteEmotionsQuestionnaire2016" role="doc-biblioref">Harmon-Jones, Bastian, and Harmon-Jones 2016</a>)</span>.</p>
<p>I started by making sure that I could exactly replicate the reported analyses. This is important because it’s easy to jump into an analysis only to find out e.g.&nbsp;that you haven’t been looking at the right dataset with the right exclusions, et cetera. I first downloaded the authors’ R scripts and datasets from <a href="https://osf.io/ac3t2/" class="uri">https://osf.io/ac3t2/</a>. Against my modal experience with looking at open datasets, this one was easy to navigate and well enough documented. Kudos to whoever was in charge of that! I show these data in <a href="#tbl-data" class="quarto-xref">Table&nbsp;1</a>.</p>
<div class="cell" data-hash="index_cache/html/tbl-data_68e4e5c0b1a94ee2189081e624a16c2d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">"_osf"</span>)) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://files.osf.io/v1/resources/ac3t2/providers/osfstorage/5fdcb348149e75052a02a4c0/?zip="</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tmp.zip"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="st">"tmp.zip"</span>, <span class="at">exdir =</span> <span class="st">"_osf"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="st">"_osf/data.zip"</span>, <span class="at">exdir =</span> <span class="st">"_osf"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlink</span>(<span class="st">"tmp.zip"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"_osf/data/processed/DF.l.inc.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ResponseId, lab, condition<span class="sc">:</span>sat) <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pid =</span> <span class="fu">fct_anon</span>(ResponseId, <span class="st">"p"</span>),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">task =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      condition, <span class="at">Pen =</span> <span class="st">"pentask"</span>, <span class="at">Mimic =</span> <span class="st">"mimicry"</span>, <span class="at">Voluntary =</span> <span class="st">"directd"</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pose =</span> <span class="fu">fct_recode</span>(trial, <span class="at">Happy =</span> <span class="st">"happy"</span>, <span class="at">Neutral =</span> <span class="st">"neutr"</span>),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">image =</span> <span class="fu">fct_recode</span>(image, <span class="at">Absent =</span> <span class="st">"absentt"</span>, <span class="at">Present =</span> <span class="st">"present"</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">"unused"</span>, <span class="at">.before =</span> <span class="dv">3</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(task, pose, image, lab, pid)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(dat, task, pose, image, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">k2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-data" class="anchored">
<table class="lightable-classic-2 lightable-striped table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;1: Experimental conditions and sample data</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">lab</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">task</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pose</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">image</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">happiness</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">enj</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">hap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lke</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0188</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">3.75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0613</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">2.25</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0188</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">1.75</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0613</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">2.25</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0624</td>
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0652</td>
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0624</td>
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">3.75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0652</td>
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">3.75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0231</td>
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0168</td>
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0231</td>
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0168</td>
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The manuscript reports various analyses with different assumptions and on different subsets of the data, but I focused on their stated primary analysis <span class="citation" data-cites="colesMultilabTestFacial2022">(<a href="#ref-colesMultilabTestFacial2022" role="doc-biblioref">Coles et al. 2022, 3</a>)</span>:</p>
<blockquote class="blockquote">
<div class="line-block"></div>
<p>Participants reported higher levels of happiness in the presence than in the absence of positive images (Mdiff = 0.30; 95% confidence interval (CI), (0.12, 0.48)). Participants also reported more happiness after posing happy versus neutral expressions (<em>M</em><sub>diff</sub> = 0.31; 95% CI, (0.21, 0.40)). Contrary to our hypothesis, the Pose effect was not significantly larger in the presence than in the absence of positive stimuli (F(1, 29.50) = 1.33, P = 0.26). <br> Unexpectedly, there was an interaction between Pose and Facial Movement Task (F(2, 32.95) = 17.11, P &lt; 0.001). The effect of Pose on self-reported happiness was the largest in the facial mimicry task (<em>M</em><sub>diff</sub> = 0.49; 95% CI, (0.36, 0.61)) and the voluntary facial action task (<em>M</em><sub>diff</sub> = 0.40; 95% CI, (0.23, 0.56)). There was moderate support for the null hypothesis in the pen-in-mouth condition (<em>M</em><sub>diff</sub> = 0.04; 95% CI, (−0.07, 0.15)).</p>
</blockquote>
<p>In other words, happy poses led to greater happiness ratings than did neutral poses in the mimicry and voluntary expression conditions, but not in the pen-in-mouth condition. (I removed lots of numbers from the quote for clarity.) Positive expressions (vs.&nbsp;neutral) increased happiness ratings when the expressions were produced voluntarily or via mimicry, but not when the expressions resulted from having a pen stuck in your mouth. I illustrate these effects in <a href="#fig-data" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div class="cell" data-hash="index_cache/html/fig-data_216afd5469f3b3ec6e28e55c88f25a69">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lab<span class="sc">:</span>happiness) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> pose, <span class="at">values_from =</span> happiness) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Neutral, Happy)) <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> .<span class="dv">25</span>, <span class="at">color =</span> <span class="st">"gray80"</span>) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_jitter</span>(.<span class="dv">1</span>, .<span class="dv">1</span>),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"white"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_centroid</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    image<span class="sc">~</span>task</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">aspect.ratio =</span> <span class="dv">1</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-data" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Mean happiness ratings following Happy and Neutral poses. Each point represents one individual’s ratings; points above the diagonal indicate greater ratings for happy poses. Points are jittered to show overlapping points on the discrete scales. Red points indicate the x-y means across participants.</figcaption>
</figure>
</div>
</div>
</div>
<p>I then estimated the authors’ model, using the same R package <span class="citation" data-cites="batesFittingLinearMixedEffects2015 batesLme4LinearMixedEffects2022 rcoreteamLanguageEnvironmentStatistical2021">(<a href="#ref-batesFittingLinearMixedEffects2015" role="doc-biblioref">Bates et al. 2015</a>, <a href="#ref-batesLme4LinearMixedEffects2022" role="doc-biblioref">2022</a>; <a href="#ref-rcoreteamLanguageEnvironmentStatistical2021" role="doc-biblioref">R Core Team 2021</a>)</span>. (I copy pasted the code but changed some variable names to help me understand what’s going on.) I then verified that I got the same results (<a href="#tbl-authors" class="quarto-xref">Table&nbsp;2</a>).</p>
<div class="cell" data-hash="index_cache/html/tbl-authors_c494b2afbfedabdb6be0c4ba3ba11a48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use contrast coding throughout</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">"contr.sum"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save model to file to save time in future runs</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"lmermodel.rds"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(path)) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    happiness <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">|</span> lab) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> pid) <span class="sc">+</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">+</span> pose <span class="sc">|</span> lab) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">+</span> task <span class="sc">|</span> lab)  <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">+</span> image <span class="sc">|</span> lab) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">+</span> pose <span class="sc">:</span> image <span class="sc">|</span> lab) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">+</span> pose <span class="sc">:</span> task <span class="sc">|</span> lab)  <span class="sc">+</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">+</span> task <span class="sc">:</span> image <span class="sc">|</span> lab) <span class="sc">+</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">+</span> pose <span class="sc">:</span> task <span class="sc">:</span> image <span class="sc">|</span> lab),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(fit, path)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(path)}</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Contrasts</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>emm_orig <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  pairwise <span class="sc">~</span> pose <span class="sc">|</span> task,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="st">"none"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">lmer.df =</span> <span class="st">"asymptotic"</span> <span class="co"># living on the edge</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>contrasts <span class="sc">%&gt;%</span> </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(task, contrast, estimate, conf.low, conf.high)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Table</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>emm_orig <span class="sc">%&gt;%</span>   </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">k2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-authors" class="anchored">
<table class="lightable-classic-2 lightable-striped table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;2: Key contrasts from original model</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">task</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">conf.low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy - Neutral</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Happy - Neutral</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Happy - Neutral</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.15</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>We see that happy poses led to ~0.4 units greater happiness ratings when the poses were done voluntarily or via facial mimicry. The difference was only 0.04 in the pen condition.</p>
<p>The above analysis is standard operating procedure for these kinds of data. We have some ordinal outcomes across multiple items and multiple sources of variation (trials, multiple responses per participant, different labs, many countries, etc.). So we take the mean (or sometimes sum) of the item responses and specify a multilevel model assuming a normal response distribution. More formally:</p>
<p><span id="eq-authors1"><span class="math display">\[
\begin{align*}
y_i &amp;\sim \text{Normal}(\mu_i, \sigma^2), \\
\mu_i &amp;= \alpha_{0} + \beta_{0\text{lab}[i]} + \gamma_{0\text{person}[i]} + \\
&amp;\quad (\alpha_{1} + \beta_{1\text{lab}[i]})\text{Pose}_i + \\
&amp;\quad (\alpha_{2} + \beta_{2\text{lab}[i]})\text{Task}_i + \\
&amp;\quad (\alpha_{3} + \beta_{3\text{lab}[i]})\text{Image}_i + \\
&amp;\quad (\alpha_{4} + \beta_{4\text{lab}[i]})\text{Pose}_i \times \text{Task}_i + \\
&amp;\quad (\alpha_{5} + \beta_{5\text{lab}[i]})\text{Pose}_i \times \text{Image}_i + \\
&amp;\quad (\alpha_{6} + \beta_{6\text{lab}[i]})\text{Task}_i \times \text{Image}_i + \\
&amp;\quad (\alpha_{7} + \beta_{7\text{lab}[i]})\text{Pose}_i \times \text{Task}_i \times \text{Image}_i,
\end{align*}
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(y_i\)</span> is the happiness rating (mean of the four items) on row <em>i</em> of the data, Pose is happy (contrast codes; 1) or neutral (-1), Task is voluntary expression (1, 0), mimicry (0, 1), or pen-in-mouth (-1, -1), and Image is the presence (-1) or absence (1) of the happy image.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Contrast coding details
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The authors used contrast coding, which is a way of coding categorical predictors such that all other effects are estimated at the average level with respect to the other predictors. This coding is detailed in <strong>?@tbl-contrasts</strong>.</p>
<div class="cell" data-hash="index_cache/html/tbl-contrasts_abf2eee97f232a7b79a6529e9ed22351">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(dat, pose, task, image), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.matrix</span>(<span class="sc">~</span>pose<span class="sc">+</span>task<span class="sc">+</span>image, <span class="at">data =</span> <span class="fu">distinct</span>(dat, pose, task, image))[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pose, task, image) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">k2</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">"Data"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Contrast codes"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="lightable-classic-2 lightable-striped table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Contrast coding of predictor variables {#tbl-contrasts}</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="TRUE">
Data
</div></th>
<th colspan="4" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="TRUE">
Contrast codes
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">task</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pose</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">image</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pose1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">task1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">task2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">image1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">Neutral</td>
<td style="text-align: left;">Present</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</div>
</div>
<p>Importantly, the model contains parameters that themselves are modelled with joint prior distributions. The person-specific deviations in the intercepts are modelled as</p>
<p><span id="eq-authors2"><span class="math display">\[
\gamma_0 \sim \text{Normal}(0, \sigma_{\gamma_0}^2).
\tag{2}\]</span></span></p>
<p>That is, they are normally distributed with mean zero and standard deviation estimated from the data. In practice, their mean will then be <span class="math inline">\(\alpha_0\)</span>, and the estimated <span class="math inline">\(\sigma_{\gamma_0}\)</span> determines their shrinkage toward the mean.</p>
<p>More importantly, the model allowed all eight parameters to vary across labs. Those parameters (or rather the deviations from the population average) are multivariate normal distributed with means 0 and the variance-covariance matrix <span class="math inline">\(\Sigma\)</span>.</p>
<p><span id="eq-authors3"><span class="math display">\[
\begin{align*}
\pmb{\beta} &amp;\sim \text{Normal}(\pmb{0}, \Sigma) \\
\Sigma &amp;= \textbf{SRS} \\
\end{align*}
\tag{3}\]</span></span></p>
<p>For technical and inconsequential reasons we rather estimate the standard deviations <strong>S</strong></p>
<p><span id="eq-authors4"><span class="math display">\[
\begin{align*}
\pmb{S} &amp;=
\begin{bmatrix}
\sigma_{\beta_0} &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;\sigma_{\beta_1} &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;\sigma_{\beta_2} &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;\sigma_{\beta_3} &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;\sigma_{\beta_4} &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;\sigma_{\beta_5} &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;\sigma_{\beta_6} &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;\sigma_{\beta_7}
\end{bmatrix},
\end{align*}
\tag{4}\]</span></span></p>
<p>and correlation matrix <strong>R</strong>. Now the verbose <code>lmer()</code> syntax above, where there were many separate statements for lab specific effects (<code>(1 | lab)</code>, <code>(0 + pose | lab)</code>, etc), indicated that all the correlations between the lab-specific parameters are set to zero:</p>
<p><span id="eq-authors5"><span class="math display">\[
\pmb{R} =
\begin{bmatrix}
1 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;1 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;1 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;1 &amp;0 \\[1ex]
0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;1 \\
\end{bmatrix},
\tag{5}\]</span></span></p>
<p>While this strategy can sometimes work pretty well and ignore some non-focal sources of variation, it doesn’t capture many features of the original data very accurately. For example, it ignores an important feature of the data generating procedure—the individual item ratings considered and decided on by the participants. In this reanalysis, I walk through these features one by one, and estimate models that allow an incrementally more accurate representation of the data generating process I believe to underlie the observed data. At each step, we assess how robust our key conclusions are to these strategic decisions.</p>
</section>
<section id="reanalysis-1-gaussian-models" class="level1 page-columns page-full">
<h1>Reanalysis 1: Gaussian models</h1>
<p>In our first analyses, we will still assume that the outcome variables are normally distributed.</p>
<section id="bayesian-estimation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="bayesian-estimation">1. Bayesian estimation</h2>
<p>When I estimated the model above I got several warning messages about “singularities”. What are they? The following quote is from <code>?lme4::isSingular</code>:</p>
<blockquote class="blockquote">
<p>While singular models are statistically well defined (it is theoretically sensible for the true maximum likelihood estimate to correspond to a singular fit), there are real concerns that (1) singular fits correspond to overfitted models that may have poor power; (2) chances of numerical problems and mis-convergence are higher for singular models (e.g.&nbsp;it may be computationally difficult to compute profile confidence intervals for such models); (3) standard inferential procedures such as Wald statistics and likelihood ratio tests may be inappropriate. There is not yet consensus about how to deal with singularity, or more generally to choose which random-effects specification (from a range of choices of varying complexity) to use. Some proposals include: […] use a fully Bayesian method that both regularizes the model via informative priors and gives estimates and credible intervals for all parameters that average over the uncertainty in the random effects parameters (Gelman and Hill 2006, McElreath 2015; MCMCglmm, rstanarm and brms packages)</p>
</blockquote>
<p>That is, multilevel models can be difficult for maximum likelihood estimation. I suspect that the empty correlation matrix <strong>R</strong> above was used to avoid more severe problems in estimating the model. Those happen to me all the time when I try to use <code>lmer()</code> with more complicated models. However! We know that bayesian estimation avoids these problems and can therefore lead to more accurate and complete estimates. In addition, bayesian estimation makes more sense than frequentist estimation (Jaynes, lindley). Our first incremental model revision, then, is to estimate the same model, but with a full correlation matrix <strong>R</strong>, using bayesian techniques.</p>
<p>That is, we implement the above equations, but this time with <strong>R</strong> that looks like this monster<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;I just had to write it out and am confident there’s at least two typos!</p></li></div><p><span class="math display">\[
\mathbf{R} =
\begin{bmatrix}
1 &amp;\rho_{\beta_0\beta_1} &amp;\rho_{\beta_0\beta_2} &amp;\rho_{\beta_0\beta_3} &amp;\rho_{\beta_0\beta_4} &amp;\rho_{\beta_0\beta_5} &amp;\rho_{\beta_0\beta_6} &amp;\rho_{\beta_0\beta_7} \\[1ex]
\rho_{\beta_0\beta_1} &amp;1 &amp;\rho_{\beta_1\beta_2} &amp;\rho_{\beta_1\beta_3} &amp;\rho_{\beta_1\beta_4} &amp;\rho_{\beta_1\beta_5} &amp;\rho_{\beta_1\beta_6} &amp;\rho_{\beta_1\beta_7} \\[1ex]
\rho_{\beta_0\beta_2} &amp;\rho_{\beta_1\beta_2} &amp;1 &amp;\rho_{\beta_2\beta_3} &amp;\rho_{\beta_2\beta_4} &amp;\rho_{\beta_2\beta_5} &amp;\rho_{\beta_2\beta_6} &amp;\rho_{\beta_2\beta_7} \\[1ex]
\rho_{\beta_0\beta_3} &amp;\rho_{\beta_1\beta_3} &amp;\rho_{\beta_2\beta_3} &amp;1 &amp;\rho_{\beta_3\beta_4} &amp;\rho_{\beta_3\beta_5} &amp;\rho_{\beta_3\beta_6} &amp;\rho_{\beta_3\beta_7} \\[1ex]
\rho_{\beta_0\beta_4} &amp;\rho_{\beta_1\beta_4} &amp;\rho_{\beta_2\beta_4} &amp;\rho_{\beta_3\beta_4} &amp;1 &amp;\rho_{\beta_4\beta_5} &amp;\rho_{\beta_4\beta_6} &amp;\rho_{\beta_4\beta_7} \\[1ex]
\rho_{\beta_0\beta_5} &amp;\rho_{\beta_1\beta_5} &amp;\rho_{\beta_2\beta_5} &amp;\rho_{\beta_3\beta_5} &amp;\rho_{\beta_4\beta_5} &amp;1 &amp;\rho_{\beta_5\beta_6} &amp;\rho_{\beta_5\beta_7} \\[1ex]
\rho_{\beta_0\beta_6} &amp;\rho_{\beta_1\beta_6} &amp;\rho_{\beta_2\beta_6} &amp;\rho_{\beta_3\beta_6} &amp;\rho_{\beta_4\beta_6} &amp;\rho_{\beta_5\beta_6} &amp;1 &amp;\rho_{\beta_6\beta_7} \\[1ex]
\rho_{\beta_0\beta_7} &amp;\rho_{\beta_1\beta_7} &amp;\rho_{\beta_2\beta_7} &amp;\rho_{\beta_3\beta_7} &amp;\rho_{\beta_4\beta_7} &amp;\rho_{\beta_5\beta_7} &amp;\rho_{\beta_6\beta_7} &amp;1 \\
\end{bmatrix}
\]</span></p>
<p>Implementing the bayesian model is very easy with the R package brms <span class="citation" data-cites="burknerAdvancedBayesianMultilevel2018 burknerBrmsPackageBayesian2017 standevelopmentteamStanModelingLanguage2021">(<a href="#ref-burknerAdvancedBayesianMultilevel2018" role="doc-biblioref">Bürkner 2018</a>, <a href="#ref-burknerBrmsPackageBayesian2017" role="doc-biblioref">2017</a>; <a href="#ref-standevelopmentteamStanModelingLanguage2021" role="doc-biblioref">Team 2021</a>)</span>. We use the extended lme4-like syntax offered by brms to specify the model</p>
<div class="cell" data-hash="index_cache/html/model-gaussian_e322536b08fda8d3e267a11418559855">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model_gaussian <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  happiness <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>l<span class="sc">|</span> lab) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> pid)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gaussian</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The above code is nearly identical to the <code>lmer()</code> code used above, but we didn’t have to split the lab-specific effects into multiple calls. Putting them into the same parentheses means they will share a full covariance matrix. I will expain the <code>|l|</code> syntax later, for now think of it simply as <code>|</code>. In addition to full lab-specific effects, we also allowed the intercepts to vary by <code>pid</code> (person identifier). And finally we specified that we want to use a gaussian outcome distribution by adding <code>guassian()</code> to the model formula.</p>
<p>To complete the model, we specify vaguely informative prior distributions. I am not setting a prior on the global intercept because I don’t have a good sense at all where it might be and am not particularly worried about this. As a result, the software we use will set a noninformative prior on it that just nudges the algorithms go brrr even better.</p>
<p><span class="math display">\[
\begin{align}
\pmb{\alpha} &amp;\sim \text{Normal}(0, 1), \\
\sigma_{\beta_0} &amp;\sim \text{t}^+(7, 0, 1), \\
\pmb{\sigma}_{\beta_{1-7}} &amp;\sim \text{t}^+(7, 0, 0.5), \\
\sigma_{\gamma_0} &amp;\sim \text{t}^+(7, 0, 2), \\
\sigma &amp;\sim \text{t}^+(7, 0, 2), \\
\textbf{R} &amp;\sim \text{LKJ}(4),
\end{align}
\]</span> where <span class="math inline">\(\text{t}^+\)</span> is the positive student’s t distribution (I indicate 7 “degrees of freedom” for each), and LKJ is a prior distribution on the correlation matrices that slightly regulates them toward zero. Here is some syntax to define the prior distributions and save them to a variable <code>priors</code>.</p>
<div class="cell" data-hash="index_cache/html/prior-gaussian_f3b7c6403b0f7f65cfbdef79c6caa02a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sd, <span class="at">group =</span> lab) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> lab) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> pid) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> sigma) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lkj_corr_cholesky</span>(<span class="dv">4</span>), <span class="at">class =</span> L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we put all these pieces together in one call to <code>brm()</code>. I define a variable for the number of iterations to use in estimating the model, because I will use this number repeatedly below. I also adjust the sampling algorithms, of which you can read more about <a href="https://mc-stan.org/users/documentation/">here</a>.</p>
<div class="cell" data-hash="index_cache/html/fit-gaussian_83615aa223b951aaa4d7b67f9373b9e5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ITER <span class="ot">&lt;-</span> <span class="dv">3000</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fit_gaussian <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  model_gaussian,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> priors,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">threads =</span> <span class="dv">2</span>, <span class="at">iter =</span> ITER,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),  <span class="co"># ask me :)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"brm-fit_gaussian"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This model already has an enormous amount of parameters, so I refrain from printing <code>summary(fit_gaussian)</code> here. Instead, I will just display the model’s population-level effects</p>
<div class="cell" data-hash="index_cache/html/summary-gaussian_483b68e8202921435f36b6df0676f427">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_posterior</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  fit_gaussian, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">centrality =</span> <span class="st">"mean"</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> <span class="st">"pd"</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effects =</span> <span class="st">"fixed"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>CI, <span class="sc">-</span>Rhat, <span class="sc">-</span>ESS) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic_2</span>(<span class="at">html_font =</span> <span class="st">"Source Sans Pro"</span>, <span class="at">lightable_options =</span> <span class="st">"striped"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="lightable-classic-2 lightable-striped table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameter</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CI_low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CI_high</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b_Intercept</td>
<td style="text-align: right;">2.43</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">2.67</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_pose1</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_task1</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.61</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_task2</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_image1</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">-0.23</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_pose1:task1</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.99</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_pose1:task2</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_pose1:image1</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.88</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_task1:image1</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">-0.19</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_task2:image1</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b_pose1:task1:image1</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_pose1:task2:image1</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>With complicated models like this, it can be very difficult to understand the results by just looking at the estimated parameters. In this reanalysis, I am primarily focusing on the pairwise comparisons of happy versus neutral poses in the three different tasks.</p>
<p>Because we will be doing this many times, I write a quick function to collect posterior samples of the key contrasts, and then visualize those</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_b736a2eec6feef490469bdcf23422ee6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>posterior_contrasts <span class="ot">&lt;-</span> <span class="cf">function</span>(model, <span class="at">dpar =</span> <span class="st">"mu"</span>) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    model,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    pairwise <span class="sc">~</span> pose <span class="sc">|</span> task,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="st">"none"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpar =</span> dpar</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather_emmeans_draws</span>(emm<span class="sc">$</span>contrasts) <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I then draw a figure of the posterior densities next to the frequentist point estimates and confidence intervals. I did not expect any differences here, as the only reason for differences in the population-level estimates would have been if the maximum likelihood had truly failed, which it didn’t.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_98b254cdbf512aaff247dc6438f89d83">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">posterior_contrasts</span>(fit_gaussian) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.value, task)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">na.translate =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated contrast (Happy - Neutral)"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">extended_breaks</span>()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">stat</span>(<span class="fu">sign</span>(xmin) <span class="sc">==</span> <span class="fu">sign</span>(xmax))),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">7</span>), </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">normalize =</span> <span class="st">"xy"</span>, </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> .<span class="dv">5</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">"mean_qi"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fatten_point =</span> <span class="fl">2.5</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_fill =</span> <span class="st">"white"</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">slab_fill =</span> <span class="st">"dodgerblue1"</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interval_size_domain = c(0.5, 1),</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval_size_range =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.1</span>),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">slab_alpha =</span> .<span class="dv">7</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">95</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrangeh</span>(</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> emm_orig,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="sc">-</span>.<span class="dv">1</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>That’s it, we’ve replicated the analysis but switched to a more robust statistical and computational framework.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Verdict: Bayesian estimation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Switching to bayesian estimation and including a full correlation matrix for the lab-specific effects did not result in meaningfully large differences in the key pairwise contrasts, as expected. However, we were able to estimate the full model without problems and therefore found bayesian estimation via <code>brm()</code> superior to maximum likelihood frequentist estimation via <code>lmer()</code>.</p>
</div>
</div>
</section>
<section id="constant-variance" class="level2">
<h2 class="anchored" data-anchor-id="constant-variance">2. Constant variance</h2>
<p>The original model assumed a constant level of residual noise for the observations:</p>
<p><span class="math display">\[
y_i \sim \text{Normal}(\mu_i, \sigma^2), \\
\]</span> where the mean of the distribution is potentially varying over the <span class="math inline">\(i\)</span> observations, but <span class="math inline">\(\sigma\)</span> is assumed constant. But just as with means, the experimental conditions, labs that participated in the study, or individual participants can have different residual variances. If these differences are not allowed for, or examined, investigators can end up missing important differences, and finding mean differences with inflated confidence (Welch). In the next model iteration, I relax the assumption of constant variances, but instead model different residuals for each experimental condition and for each experimental condition in each lab.</p>
<p>That is, I modify the previous model to also model <span class="math inline">\(\sigma\)</span> on the same predictors:</p>
<p><span class="math display">\[
\begin{align*}
y_i &amp;\sim \text{Normal}(\mu_i, \sigma^2), \\
\mu_i &amp;= \alpha^{\mu}_{0} + \beta^{\mu}_{0\text{lab}[i]} + \gamma^{\mu}_{0\text{person}[i]} + \\
&amp;\quad (\alpha^{\mu}_{1} + \beta^{\mu}_{1\text{lab}[i]})\text{Pose}_i + \\
&amp;\quad (\alpha^{\mu}_{2} + \beta^{\mu}_{2\text{lab}[i]})\text{Task}_i + \\
&amp;\quad (\alpha^{\mu}_{3} + \beta^{\mu}_{3\text{lab}[i]})\text{Image}_i + \\
&amp;\quad (\alpha^{\mu}_{4} + \beta^{\mu}_{4\text{lab}[i]})\text{Pose}_i \times \text{Task}_i + \\
&amp;\quad (\alpha^{\mu}_{5} + \beta^{\mu}_{5\text{lab}[i]})\text{Pose}_i \times \text{Image}_i + \\
&amp;\quad (\alpha^{\mu}_{6} + \beta^{\mu}_{6\text{lab}[i]})\text{Task}_i \times \text{Image}_i + \\
&amp;\quad (\alpha^{\mu}_{7} + \beta^{\mu}_{7\text{lab}[i]})\text{Pose}_i \times \text{Task}_i \times \text{Image}_i, \\
\text{log}(\sigma_i) &amp;= \alpha^{\sigma}_{0} + \beta^{\sigma}_{0\text{lab}[i]} + \gamma^{\sigma}_{0\text{person}[i]} + \\
&amp;\quad (\alpha^{\sigma}_{1} + \beta^{\sigma}_{1\text{lab}[i]})\text{Pose}_i + \\
&amp;\quad (\alpha^{\sigma}_{2} + \beta^{\sigma}_{2\text{lab}[i]})\text{Task}_i + \\
&amp;\quad (\alpha^{\sigma}_{3} + \beta^{\sigma}_{3\text{lab}[i]})\text{Image}_i + \\
&amp;\quad (\alpha^{\sigma}_{4} + \beta^{\sigma}_{4\text{lab}[i]})\text{Pose}_i \times \text{Task}_i + \\
&amp;\quad (\alpha^{\sigma}_{5} + \beta^{\sigma}_{5\text{lab}[i]})\text{Pose}_i \times \text{Image}_i + \\
&amp;\quad (\alpha^{\sigma}_{6} + \beta^{\sigma}_{6\text{lab}[i]})\text{Task}_i \times \text{Image}_i + \\
&amp;\quad (\alpha^{\sigma}_{7} + \beta^{\sigma}_{7\text{lab}[i]})\text{Pose}_i \times \text{Task}_i \times \text{Image}_i.
\end{align*}
\]</span></p>
<p>Here, I refrain from writing out the corresponding <strong>S</strong> and <strong>R</strong>, because my fingers and our eyes might fall off. Note here that because we want to construct a linear model of the standard deviation, which must be positive, we model it through the log-link function. brms does this automatically, but we have to keep it in mind in case we make the mistake of looking at the raw parameter estimates!</p>
<p>To do this, we add another linear formula to the previous model using <code>... + lf()</code> (for <strong>l</strong>inear <strong>f</strong>unction). But instead of specifying the variable we are modelling as above, we model <code>sigma</code> like this:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_6bb8aecc773efb31c1320afefdc41b07">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model_gaussian_sigma <span class="ot">&lt;-</span> model_gaussian <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lf</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>l<span class="sc">|</span> lab)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In addition, we now see the <code>|l|</code> syntax appear again in the lab-varying effects specification. This means that all lab-varying effects share the same variance-covariance matrix. (The letter or text between the bars is arbitrary, and I chose “l” short for “lab”.) That is, now for example the lab-specific intercepts for the mean parameter and standard deviation parameters are allowed to correlate with each other.</p>
<p>In practice, this means that the shrinkage—the pulling of lab-specific parameters towards their means—happens in more dimensions, and the increased information pooling is theoretically making them on aggregate more predictive of the actual underlying parameters (Gelman, Mcelreath, ).</p>
<p>Importantly, I repeat that the linear predictor for sigma—the combination of the predictors—is passed through a log-link function in order to ensure that the actual predicted quantity, the standard deviation, is positive. We return to this point when interpreting the parameter estimates.</p>
<p>We again complete the model by specifying weakly informative prior distributions on the sigma predictors and (co)variances across labs. These numbers might appear small, but recall that they are on the log scale.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_2a93c6b481f90d7afa17eb4c7ac374af">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add more priors, take out prior for global sigma which doesn't exist anymore</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> priors[<span class="sc">-</span><span class="dv">5</span>,] <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> sigma) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> sd, <span class="at">group =</span> lab, <span class="at">dpar =</span> sigma) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> L, <span class="at">group =</span> lab, <span class="at">dpar =</span> sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We fit the model with the same code as above, but use the updated model and priors.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_d57f793c681027bc1c4659aa39564edf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit_gaussian_sigma <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  model_gaussian_sigma,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> priors,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">threads =</span> <span class="dv">2</span>, <span class="at">iter =</span> ITER,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"brm-fit_gaussian_sigma"</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then examine whether including this structure of varying residual standard deviances has improved the model’s predictive performance. I do this with leave-one-out cross-validation (LOO), which estimates the models out of sample predictive accuracy (Vehtari). The model that did not assume a constant residual variance had a higher ELPD (expected log predictive density), which indicates better estimated prediction accuracy for that model. The difference is quite large, and suggests to us that we have improved our model.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_505c84df6c11e5cb7c549b138aab1886">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fit_gaussian <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit_gaussian, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>fit_gaussian_sigma <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit_gaussian_sigma, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit_gaussian, fit_gaussian_sigma, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   elpd_diff se_diff
fit_gaussian_sigma    0.0       0.0 
fit_gaussian       -530.8      36.3 </code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_1d13f50e41845b74bf9d41b5c98d9ee4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot</span>(<span class="fu">conditional_effects</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  fit_gaussian_sigma,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"task:pose"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>), <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]] <span class="sc">|</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">conditional_effects</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    fit_gaussian_sigma,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"task:pose"</span>, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpar =</span> <span class="st">"sigma"</span>, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]]) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_de5e6f05de28ff665ca511f587e34491">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>post_mu <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gaussian"</span> <span class="ot">=</span> <span class="fu">posterior_contrasts</span>(fit_gaussian),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gaussian (sigma)"</span> <span class="ot">=</span> <span class="fu">posterior_contrasts</span>(fit_gaussian_sigma), </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">"Model"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>post_sigma <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gaussian"</span> <span class="ot">=</span> <span class="fu">as_draws_df</span>(fit_gaussian, <span class="at">variable =</span> <span class="st">"sigma"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">.value =</span> <span class="st">"sigma"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">crossing</span>(<span class="fu">distinct</span>(post_mu, contrast, task)),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gaussian (sigma)"</span> <span class="ot">=</span> <span class="fu">posterior_contrasts</span>(fit_gaussian_sigma, <span class="st">"sigma"</span>), </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">"Model"</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mu"</span> <span class="ot">=</span> post_mu, <span class="st">"sigma"</span> <span class="ot">=</span> post_sigma, <span class="at">.id =</span> <span class="st">"Parameter"</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.value, task, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated contrast (Happy - Neutral)"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">extended_breaks</span>()</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">stat</span>(<span class="fu">sign</span>(xmin) <span class="sc">==</span> <span class="fu">sign</span>(xmax))),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">5</span>), </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">normalize =</span> <span class="st">"xy"</span>, </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> .<span class="dv">45</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">"mean_qi"</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">fatten_point =</span> <span class="fl">2.5</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_fill =</span> <span class="st">"white"</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interval_size_domain = c(0.5, 1),</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval_size_range =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.1</span>),</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">slab_alpha =</span> .<span class="dv">7</span>,</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">95</span>)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrangeh</span>(</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> emm_orig <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="st">"mu"</span>),</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high),</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="sc">-</span>.<span class="dv">2</span>)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">distinct</span>(emm_orig, task, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="st">"sigma"</span>, <span class="at">sigma =</span> <span class="fu">sigma</span>(fit)),</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> sigma), <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="sc">-</span>.<span class="dv">2</span>)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">shape =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"Parameter"</span>) <span class="sc">+</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Verdict: Modelling sigma
</div>
</div>
<div class="callout-body-container callout-body">
<p>Allowing different residual deviations for the experimental conditions and labs did not change the focal mean differences in a meaningful manner. It did, however, lead to a large improvement in the model’s estimated predictive accuracy.</p>
</div>
</div>
</section>
<section id="varying-items" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="varying-items">3. Varying items</h2>
<p>So far, we’ve modelled the same aggregated happiness subscale means as the original analysis. However, an implicit step of that analysis is the aggregation of the four responses into a single mean. In structural equation modelling world, which I have seen a glimpse of in a fever dream, that is equivalent to assuming that all the four items load equally to a latent “happiness” variable. While practically useful, this can be a somewhat suspicious assumption. In my neck of the woods, we might address this assumption by allowing for some or all of the model variables to vary between the four items. Then, we will not only be modelling the mean “happiness”, by virtue of the item-varying effects’ mean parameter, but also item-specific effects. We can then examine the latter directly, and their heterogeneity via the item-varying effects standard deviation.</p>
<p>First, to model the four outcomes together while allowing for differences between them, we must pivot the data into a “long format” with respect to the items:</p>
<div class="cell" data-hash="index_cache/html/data-pivot_3acf6f92e2b7f096305c5d088aa7c695">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(enj, hap, lke, sat), </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"item"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"response"</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>happiness)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d) <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic_2</span>(<span class="at">html_font =</span> <span class="st">"Source Sans Pro"</span>, <span class="at">lightable_options =</span> <span class="st">"striped"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="lightable-classic-2 lightable-striped table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Data in long format with regard to “item”</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">lab</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">task</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pose</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">image</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">item</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0188</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: left;">enj</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0188</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: left;">hap</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0188</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: left;">lke</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0188</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: left;">sat</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0895</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: left;">enj</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0895</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: left;">hap</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>As a consequence, we now have a new outcome variable <code>response</code>, and a predictor variable called <code>item</code>. What we can then do is rewrite our model to include item-specific deviations from the average parameters. In essence, this reformulation will include a lot more information in the model by virtue of modelling the individual responses. It will also respect the hypothetical data generating mechanism—the thought process and mechanics that go into giving an individual rating response—better and thus might ultimately be a more informative model with respect to psychological theory. We write this model as</p>
<p><span class="math display">\[
\begin{align*}
y_i &amp;\sim \text{Normal}(\mu_i, \sigma^2), \\
\mu_i &amp;= \alpha_{0} + \beta_{0\text{lab}[i]} + \delta_{0\text{item}[i]} + \gamma_{0\text{person}[i]} + \\
&amp;\quad (\alpha_{1} + \beta_{1\text{lab}[i]} + \delta_{1\text{item}[i]})\text{Pose}_i + \\
&amp;\quad (\alpha_{2} + \beta_{2\text{lab}[i]} + \delta_{2\text{item}[i]})\text{Task}_i + \\
&amp;\quad (\alpha_{3} + \beta_{3\text{lab}[i]} + \delta_{3\text{item}[i]})\text{Image}_i + \\
&amp;\quad (\alpha_{4} + \beta_{4\text{lab}[i]} + \delta_{4\text{item}[i]})\text{Pose}_i \times \text{Task}_i + \\
&amp;\quad (\alpha_{5} + \beta_{5\text{lab}[i]} + \delta_{5\text{item}[i]})\text{Pose}_i \times \text{Image}_i + \\
&amp;\quad (\alpha_{6} + \beta_{6\text{lab}[i]} + \delta_{6\text{item}[i]})\text{Task}_i \times \text{Image}_i + \\
&amp;\quad (\alpha_{7} + \beta_{7\text{lab}[i]} + \delta_{7\text{item}[i]})\text{Pose}_i \times \text{Task}_i \times \text{Image}_i, \\
\gamma_0 &amp;\sim \text{Normal}(0, \sigma_{\gamma_0}^2), \\
\pmb{\beta} &amp;\sim \text{Normal}(\pmb{0}, \Sigma^{\text{lab}}) \\
\pmb{\delta} &amp;\sim \text{Normal}(\pmb{0}, \Sigma^{\text{item}}) \\
\Sigma^{\text{lab}} &amp;= \textbf{S}^{\text{lab}}\textbf{R}^{\text{lab}}\textbf{S}^{\text{lab}} \\
\Sigma^{\text{item}} &amp;= \textbf{S}^{\text{item}}\textbf{R}^{\text{item}}\textbf{S}^{\text{item}} \\
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(y_i\)</span> is now the item response on row <em>i</em> of the data, and we have two variance-covariance matrices, one for labs and one for items.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="no-row-height column-margin column-container"><li id="fn4"><p><sup>4</sup>&nbsp;Dear lord there must be a better way for writing this out.</p></li></div><p>We then translate this into code with a call very similar to above:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_eeccdffbadb2c2d13f8a469fe84e50f3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model specification</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model_gaussian_item <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  response <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>l<span class="sc">|</span> lab) <span class="sc">+</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>i<span class="sc">|</span> item) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> pid)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gaussian</span>()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>fit_gaussian_item <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  model_gaussian_item,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">threads =</span> <span class="dv">2</span>, <span class="at">iter =</span> ITER,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"brm-fit_gaussian_item"</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Before looking at the model in more detail, let us first simply compare its population-level parameters (those that indicate effects for “the average item and average lab”) to those of previous models:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_6e025245f69684ab2271142a17d59aa5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit =</span> <span class="fu">list</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    fit_gaussian, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    fit_gaussian_sigma, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    fit_gaussian_item</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gaussian"</span>, <span class="st">"Gaussian (sigma)"</span>, <span class="st">"Gaussian (item)"</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">fct_inorder</span>(model)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrasts =</span> <span class="fu">map</span>(fit, posterior_contrasts)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>pds <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pd =</span> <span class="fu">map</span>(</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>      contrasts,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">group_by</span>(.x, contrast, task) <span class="sc">%&gt;%</span> </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_modify</span>(<span class="sc">~</span><span class="fu">describe_posterior</span>(.<span class="sc">$</span>.value, <span class="at">test =</span> <span class="st">"pd"</span>))</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, pd) <span class="sc">%&gt;%</span> </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pd)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>out <span class="sc">%&gt;%</span> </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fit) <span class="sc">%&gt;%</span> </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(contrasts) <span class="sc">%&gt;%</span> </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.value, task, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated contrast (Happy - Neutral)"</span>,</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">extended_breaks</span>()</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">stat</span>(<span class="fu">sign</span>(xmin) <span class="sc">==</span> <span class="fu">sign</span>(xmax))),</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">7</span>), </span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">normalize =</span> <span class="st">"xy"</span>, </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> .<span class="dv">5</span>,</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">"mean_qi"</span>,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">fatten_point =</span> <span class="dv">3</span>,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_fill =</span> <span class="st">"white"</span>,</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval_size_range =</span> <span class="fu">c</span>(.<span class="dv">35</span>, .<span class="dv">7</span>),</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">slab_alpha =</span> .<span class="dv">75</span>,</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">95</span>)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> pds,</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(pd, .<span class="dv">1</span>), <span class="at">x =</span> CI_high),</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">7</span>),</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.2</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">shape =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Although we observe similar posterior means across the models, our latest model’s parameters are quite a bit more uncertain. Below and to the right of each posterior density, I display the parameter’s posterior probability of direction. Although the differences between models are not great, we see that as we’ve built our models, those have tended to decrease. This is a result of including more sources of uncertainty in the model. However, because we can now investigate the items and the heterogeneity in effects therein, we should look at them to see whether the mean is a representative estimate.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_ed4aeaae1cbdbb7ba0b113914d4076ba">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  fit_gaussian_item,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  pairwise <span class="sc">~</span> pose <span class="sc">|</span> task,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="st">"none"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Voluntary =</span> <span class="st">"pose1*2 + pose1:task1*2 + pose1:task2*0 = 0"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mimic =</span> <span class="st">"pose1*2 + pose1:task1*0 + pose1:task2*2 = 0"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pen =</span> <span class="st">"pose1*2 + pose1:task1*-2 + pose1:task2*-2 = 0"</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">hypothesis</span>(fit_gaussian_item, h, <span class="at">scope =</span> <span class="st">"coef"</span>, <span class="at">group =</span> <span class="st">"item"</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(out<span class="sc">$</span>samples) <span class="ot">&lt;-</span> <span class="fu">interaction</span>(out<span class="sc">$</span>hypothesis<span class="sc">$</span>Group, out<span class="sc">$</span>hypothesis<span class="sc">$</span>Hypothesis)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> out<span class="sc">$</span>samples <span class="sc">%&gt;%</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"draw"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>draw) <span class="sc">%&gt;%</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="fu">c</span>(<span class="st">"item"</span>, <span class="st">"task"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">task =</span> <span class="fu">fct_inorder</span>(task))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>out <span class="sc">%&gt;%</span> </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value, task, <span class="at">fill =</span> item)) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated contrast (Happy - Neutral)"</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">extended_breaks</span>(),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">stat</span>(<span class="fu">sign</span>(xmin) <span class="sc">==</span> <span class="fu">sign</span>(xmax))),</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">7</span>), </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">normalize =</span> <span class="st">"xy"</span>, </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> .<span class="dv">5</span>,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">"mean_qi"</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">fatten_point =</span> <span class="dv">3</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_fill =</span> <span class="st">"white"</span>,</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval_size_range =</span> <span class="fu">c</span>(.<span class="dv">35</span>, .<span class="dv">7</span>),</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">slab_alpha =</span> .<span class="dv">75</span>,</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">95</span>)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">shape =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What are we to do with this information? Well, one might be interested in whether the effects of the facial expression tasks are different depending on whether participants report on happiness, enjoyment, liking, or satisfaction. To illustrate, I compare the pose effect (happy - neutral) in the three tasks between responses to the happiness item and the three other items. We find that the poses had a greater effect on happiness than on liking or satisfaction (but not enjoyment) in the voluntary and mimic conditions, but not in the pen condition.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_ca46a727be0be6a297cdaf6cd757d60d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>out <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> item, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">hap-sat</span><span class="st">`</span> <span class="ot">=</span> hap<span class="sc">-</span>sat,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">hap-enj</span><span class="st">`</span> <span class="ot">=</span> hap<span class="sc">-</span>enj,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">hap-lke</span><span class="st">`</span> <span class="ot">=</span> hap<span class="sc">-</span>lke</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(task) <span class="sc">%&gt;%</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"-"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>task, <span class="at">names_to =</span> <span class="st">"contrast"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(task, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(task, contrast, <span class="at">Mean =</span> value, <span class="at">CI_low =</span> .lower, <span class="at">CI_high =</span> .upper) <span class="sc">%&gt;%</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic_2</span>(<span class="at">lightable_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="lightable-classic-2 lightable-striped table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">task</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CI_low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CI_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">hap-enj</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.18</td>
</tr>
<tr class="even">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">hap-lke</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">hap-sat</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">hap-enj</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">hap-lke</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mimic</td>
<td style="text-align: left;">hap-sat</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">hap-enj</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">hap-lke</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pen</td>
<td style="text-align: left;">hap-sat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">0.15</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-18_09707a3b06f183621977ddd187693a61">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model_gaussian_item_sigma <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  response <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>l<span class="sc">|</span> lab) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>i<span class="sc">|</span> item) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> pid)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lf</span>(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      (pose <span class="sc">+</span> task <span class="sc">+</span> image <span class="sc">|</span>l<span class="sc">|</span> lab) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      (pose <span class="sc">+</span> task <span class="sc">+</span> image <span class="sc">|</span>i<span class="sc">|</span> item)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> priors <span class="sc">+</span> </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> sd, <span class="at">group =</span> item, <span class="at">coef =</span> Intercept) <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> item) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sd, <span class="at">group =</span> item, <span class="at">dpar =</span> sigma)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>fit_gaussian_item_sigma <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  model_gaussian_item_sigma,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> priors,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">threads =</span> <span class="dv">2</span>, <span class="at">iter =</span> ITER,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"brm-fit_gaussian_item_sigma"</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_44c2e975541f5947651de30b522a847a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_gaussian_item_sigma <span class="ot">&lt;-</span> model_gaussian_item <span class="sc">+</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lf</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>      (pose <span class="sc">+</span> task <span class="sc">+</span> image <span class="sc">|</span>l<span class="sc">|</span> lab)<span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>      (pose <span class="sc">+</span> task <span class="sc">+</span> image <span class="sc">|</span>i<span class="sc">|</span> item)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>fit_gaussian_item_sigma <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  model_gaussian_item_sigma,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">threads =</span> <span class="dv">2</span>, <span class="at">iter =</span> ITER,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"brm-fit_gaussian_item_sigma"</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_fa0336c9f300f5be84ebf0d6069d4d16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit_gaussian_item <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit_gaussian_item, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit_gaussian_item_sigma <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit_gaussian_item_sigma, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit_gaussian_item, fit_gaussian_item_sigma, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        elpd_diff se_diff
fit_gaussian_item_sigma    0.0       0.0 
fit_gaussian_item       -857.0     172.5 </code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-21_ab2e92bd1909cec2370a785e7c580381">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit =</span> <span class="fu">list</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    fit_gaussian, </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    fit_gaussian_sigma, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    fit_gaussian_item, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    fit_gaussian_item_sigma</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gaussian"</span>, <span class="st">"gaussian_sigma"</span>, <span class="st">"gaussian_item"</span>, <span class="st">"gaussian_item_sigma"</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrasts =</span> <span class="fu">map</span>(fit, posterior_contrasts)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>out <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fit) <span class="sc">%&gt;%</span> </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(contrasts) <span class="sc">%&gt;%</span> </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.value, task, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated contrast (Happy - Neutral)"</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">extended_breaks</span>()</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">stat</span>(<span class="fu">sign</span>(xmin) <span class="sc">==</span> <span class="fu">sign</span>(xmax))),</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">7</span>), </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">normalize =</span> <span class="st">"xy"</span>, </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> .<span class="dv">5</span>,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">"mean_qi"</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">fatten_point =</span> <span class="dv">3</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_fill =</span> <span class="st">"white"</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval_size_range =</span> <span class="fu">c</span>(.<span class="dv">35</span>, .<span class="dv">7</span>),</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">slab_alpha =</span> .<span class="dv">75</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">95</span>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">shape =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="reanalysis-2-ordinal-models" class="level1">
<h1>Reanalysis 2: Ordinal models</h1>
<p>Previously, we assumed that conditional on the predictors, the data are normally distributed with a constant level of residual variation. But we know that the data collected are not “normal”, but instead sum-scores of four ordinal items. We know that analysing ordinal items as if they were metric can be a pretty bad idea <span class="citation" data-cites="liddellAnalyzingOrdinalData2018">(<a href="#ref-liddellAnalyzingOrdinalData2018" role="doc-biblioref">Liddell and Kruschke 2018</a>)</span>, and that there are other models better suited for ordinal outcomes <span class="citation" data-cites="burknerOrdinalRegressionModels2019">(<a href="#ref-burknerOrdinalRegressionModels2019" role="doc-biblioref">Bürkner and Vuorre 2019</a>)</span>. In this reanalysis, I will use ordinal models to better represent the ordinal nature of the outcomes. As an added bonus, this will allow us to examine differential effects on the four different aspects of “happiness”.</p>
<p>Instead of modelling the mean of enjoyment, happiness, liking, and satisfaction as normally distributed conditional on the model, we model each of the individual responses as ordinal, using a cumulative probit model <span class="citation" data-cites="burknerOrdinalRegressionModels2019">(<a href="#ref-burknerOrdinalRegressionModels2019" role="doc-biblioref">Bürkner and Vuorre 2019</a>)</span>. A word of warning; this gets hairy real fast.</p>
<p>We will now be able to model the parameters as varying across the four items, with an empirical multivariate normal prior distribution (“random effects” <span class="citation" data-cites="juddTreatingStimuliRandom2012">(<a href="#ref-juddTreatingStimuliRandom2012" role="doc-biblioref">Judd, Westfall, and Kenny 2012</a>)</span>), just as we did above where we specified varying effects over labs. In addition to then getting item-specific parameters, their prior distribution will give us average parameters (“fixed effects” or “population-level parameters” <span class="citation" data-cites="gelmanDataAnalysisUsing2007">(<a href="#ref-gelmanDataAnalysisUsing2007" role="doc-biblioref">Gelman and Hill 2007, 245</a> footnote 2.)</span>) that indicate quantities “for the average item”, and (co)variances across the items.</p>
<p>In addition, I specify that the thresholds that partition the latent “happiness” variable into observed responses are estimated wholly separately for the items.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_b9f5378322c9168dcfb13a1520e7a59f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model_ordinal <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  response <span class="sc">|</span> <span class="fu">thres</span>(<span class="at">gr =</span> item) <span class="sc">~</span> pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>l<span class="sc">|</span> lab) <span class="sc">+</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    (pose <span class="sc">*</span> task <span class="sc">*</span> image <span class="sc">|</span>i<span class="sc">|</span> item) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> pid)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cumulative</span>(<span class="st">"probit_approx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the above, I specified <code>cumulative("probit_approx")</code>, which indicates a cumulative family of the response probabilities, with an approximate probit link function. This is slightly faster than the <code>"probit"</code>, but gives basically the same results with simpler calculations. We then draw samples from the model, and initialize all chains at zero, which usually helps in sampling from these models.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-23_83913e4f1af37e65108bf763e8937722">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fit_ordinal <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  model_ordinal,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> <span class="dv">0</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">threads =</span> <span class="dv">2</span>, <span class="at">iter =</span> ITER,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"brm-fit_ordinal"</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Varying variance</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-24_922282c736d3ae8a161c3f4039eddacb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model_ordinal_sigma <span class="ot">&lt;-</span> model_ordinal <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lf</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    disc <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> pose <span class="sc">+</span> task <span class="sc">+</span> image <span class="sc">+</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      (pose <span class="sc">+</span> task <span class="sc">+</span> image <span class="sc">|</span>l<span class="sc">|</span> lab) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      (pose <span class="sc">+</span> task <span class="sc">+</span> image <span class="sc">|</span>i<span class="sc">|</span> item), </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cmc =</span> <span class="cn">FALSE</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(model_ordinal_sigma, d)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> disc) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> lab) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> sd, <span class="at">group =</span> lab) <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> lab, <span class="at">dpar =</span> disc) <span class="sc">+</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> sd, <span class="at">group =</span> lab, <span class="at">dpar =</span> disc) <span class="sc">+</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lkj_corr_cholesky</span>(<span class="dv">4</span>), <span class="at">class =</span> L, <span class="at">group =</span> lab) <span class="sc">+</span> </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> item) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> sd, <span class="at">group =</span> item) <span class="sc">+</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> item, <span class="at">dpar =</span> disc) <span class="sc">+</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> sd, <span class="at">group =</span> item, <span class="at">dpar =</span> disc) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lkj_corr_cholesky</span>(<span class="dv">4</span>), <span class="at">class =</span> L, <span class="at">group =</span> item) <span class="sc">+</span> </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> pid)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>fit_ordinal_sigma <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  model_ordinal_sigma,</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> <span class="dv">0</span>,</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> priors,</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">threads =</span> <span class="dv">2</span>, <span class="at">iter =</span> ITER,</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"brm-fit_ordinal_sigma"</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="effect-size" class="level1">
<h1>Effect size</h1>
<p>Do this: https://solomonkurz.netlify.app/post/2022-07-18-sum-score-effect-sizes-for-multilevel-bayesian-cumulative-probit-models/</p>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>Yolo</p>
</section>




<div id="quarto-appendix" class="default"><section id="latent-variable-approach" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Latent variable approach</h2><div class="quarto-appendix-contents">

<p>Latent variable modelling and SEM is out of my wheel house so I’ve left this to an appendix. The basic idea here is that the “happiness” rating modelled in the original analysis is the mean of four different items, happiness, liking, enjoyment, and satisfaction. Using a mean of those is equivalent to a latent construct whose item factor loadings are all 1. However, it is not established that those items load equally to a latent attribute that we might call “happiness”.</p>
<p>In my reanalysis above, we allowed item-specific parameters, and were able to examine their means as well. That bears some small resemblance to what we will do now. We will estimate a multiple factor latent variable for each observation (combination of four item ratings), and then output that variable to use in the multilevel model in lieu of the mean. It would be better to do this CFA and multilevel regression in the same model so as to not discard the latent variable uncertainty, but I don’t know how to do that, ergo the two-step procedure. Recall that our data looks like this</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-25_3aee3cabe5752a64131867fd122b3cd1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat, <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">lab</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">task</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pose</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">image</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">happiness</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">enj</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">hap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lke</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0188</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">3.75</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p0895</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">2.25</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUS_01</td>
<td style="text-align: left;">p1417</td>
<td style="text-align: left;">Voluntary</td>
<td style="text-align: left;">Happy</td>
<td style="text-align: left;">Absent</td>
<td style="text-align: right;">3.75</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We then first specify the CFA model to estimate the latent variable “happiness”, using lavaan.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-26_822ac256dbb7cb271758e4816df980e2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>model_cfa <span class="ot">&lt;-</span> <span class="st">'y  =~ hap + enj + lke + sat'</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>fit_cfa <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model_cfa, <span class="at">data =</span> dat)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cfa, <span class="at">fit.measures =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-12 ended normally after 23 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         8

  Number of observations                          3008

Model Test User Model:
                                                      
  Test statistic                                 7.158
  Degrees of freedom                                 2
  P-value (Chi-square)                           0.028

Model Test Baseline Model:

  Test statistic                              9777.211
  Degrees of freedom                                 6
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.999
  Tucker-Lewis Index (TLI)                       0.998

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -18329.229
  Loglikelihood unrestricted model (H1)     -18325.650
                                                      
  Akaike (AIC)                               36674.457
  Bayesian (BIC)                             36722.529
  Sample-size adjusted Bayesian (BIC)        36697.110

Root Mean Square Error of Approximation:

  RMSEA                                          0.029
  90 Percent confidence interval - lower         0.008
  90 Percent confidence interval - upper         0.054
  P-value RMSEA &lt;= 0.05                          0.913

Standardized Root Mean Square Residual:

  SRMR                                           0.004

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  y =~                                                
    hap               1.000                           
    enj               1.000    0.014   71.273    0.000
    lke               0.976    0.014   71.297    0.000
    sat               0.928    0.015   62.656    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .hap               0.548    0.020   26.792    0.000
   .enj               0.593    0.021   27.700    0.000
   .lke               0.564    0.020   27.682    0.000
   .sat               0.840    0.026   32.172    0.000
    y                 2.243    0.072   31.106    0.000</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(dat, <span class="at">hpn =</span> <span class="fu">predict</span>(fit_cfa)[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div></section><section id="notes" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Notes</h2><div class="quarto-appendix-contents">

<p>Nothing here has been peer-reviewed or sanity checked by experts or non-experts.</p>



</div></section><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-batesFittingLinearMixedEffects2015" class="csl-entry" role="listitem">
Bates, Douglas M., Martin Mächler, Ben M. Bolker, and Steve Walker. 2015. <span>“Fitting <span>Linear Mixed-Effects Models Using</span> Lme4.”</span> <em>Journal of Statistical Software</em> 67 (1): 1–48. <a href="https://doi.org/10.18637/jss.v067.i01">https://doi.org/10.18637/jss.v067.i01</a>.
</div>
<div id="ref-batesLme4LinearMixedEffects2022" class="csl-entry" role="listitem">
Bates, Douglas M., Martin Mächler, Ben M. Bolker, Steven Walker, Rune Haubo Bojesen Christensen, Henrik Singmann, Bin Dai, et al. 2022. <span>“Lme4: <span>Linear Mixed-Effects Models</span> Using ’<span>Eigen</span>’ and <span>S4</span>.”</span> <a href="https://CRAN.R-project.org/package=lme4">https://CRAN.R-project.org/package=lme4</a>.
</div>
<div id="ref-burknerBrmsPackageBayesian2017" class="csl-entry" role="listitem">
Bürkner, Paul-Christian. 2017. <span>“Brms: <span>An R Package</span> for <span>Bayesian Multilevel Models Using Stan</span>.”</span> <em>Journal of Statistical Software</em> 80 (1): 1–28. <a href="https://doi.org/10.18637/jss.v080.i01">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-burknerAdvancedBayesianMultilevel2018" class="csl-entry" role="listitem">
———. 2018. <span>“Advanced <span>Bayesian Multilevel Modeling</span> with the <span>R Package</span> Brms.”</span> <em>The R Journal</em> 10 (1): 395–411. <a href="https://journal.r-project.org/archive/2018/RJ-2018-017/index.html">https://journal.r-project.org/archive/2018/RJ-2018-017/index.html</a>.
</div>
<div id="ref-burknerOrdinalRegressionModels2019" class="csl-entry" role="listitem">
Bürkner, Paul-Christian, and Matti Vuorre. 2019. <span>“Ordinal <span>Regression Models</span> in <span>Psychology</span>: <span>A Tutorial</span>.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 2 (1): 77–101. <a href="https://doi.org/10.1177/2515245918823199">https://doi.org/10.1177/2515245918823199</a>.
</div>
<div id="ref-colesMultilabTestFacial2022" class="csl-entry" role="listitem">
Coles, Nicholas A., David S. March, Fernando Marmolejo-Ramos, Jeff T. Larsen, Nwadiogo C. Arinze, Izuchukwu L. G. Ndukaihe, Megan L. Willis, et al. 2022. <span>“A Multi-Lab Test of the Facial Feedback Hypothesis by the <span>Many Smiles Collaboration</span>.”</span> <em>Nature Human Behaviour</em>, October. <a href="https://doi.org/10.1038/s41562-022-01458-9">https://doi.org/10.1038/s41562-022-01458-9</a>.
</div>
<div id="ref-gelmanDataAnalysisUsing2007" class="csl-entry" role="listitem">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data <span>Analysis Using Regression</span> and <span>Multilevel</span>/<span>Hierarchical Models</span></em>. <span>New York, NY</span>: <span>Cambridge University Press</span>.
</div>
<div id="ref-harmon-jonesDiscreteEmotionsQuestionnaire2016" class="csl-entry" role="listitem">
Harmon-Jones, Cindy, Brock Bastian, and Eddie Harmon-Jones. 2016. <span>“The <span>Discrete Emotions Questionnaire</span>: <span>A New Tool</span> for <span>Measuring State Self-Reported Emotions</span>.”</span> <em>PLOS ONE</em> 11 (8): e0159915. <a href="https://doi.org/10.1371/journal.pone.0159915">https://doi.org/10.1371/journal.pone.0159915</a>.
</div>
<div id="ref-juddTreatingStimuliRandom2012" class="csl-entry" role="listitem">
Judd, Charles M., Jacob Westfall, and David A. Kenny. 2012. <span>“Treating Stimuli as a Random Factor in Social Psychology: <span>A</span> New and Comprehensive Solution to a Pervasive but Largely Ignored Problem.”</span> <em>Journal of Personality and Social Psychology</em> 103 (1): 54–69. <a href="https://doi.org/10.1037/a0028347">https://doi.org/10.1037/a0028347</a>.
</div>
<div id="ref-liddellAnalyzingOrdinalData2018" class="csl-entry" role="listitem">
Liddell, Torrin M., and John K. Kruschke. 2018. <span>“Analyzing Ordinal Data with Metric Models: <span>What</span> Could Possibly Go Wrong?”</span> <em>Journal of Experimental Social Psychology</em> 79 (November): 328–48. <a href="https://doi.org/10.1016/j.jesp.2018.08.009">https://doi.org/10.1016/j.jesp.2018.08.009</a>.
</div>
<div id="ref-rcoreteamLanguageEnvironmentStatistical2021" class="csl-entry" role="listitem">
R Core Team. 2021. <span>“R: <span>A Language</span> and <span>Environment</span> for <span>Statistical Computing</span>. <span>Version</span> 4.1.1.”</span> <span>Vienna, Austria</span>: <span>R Foundation for Statistical Computing</span>. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-strackInhibitingFacilitatingConditions1988" class="csl-entry" role="listitem">
Strack, Fritz, Leonard L. Martin, and Sabine Stepper. 1988. <span>“Inhibiting and Facilitating Conditions of the Human Smile: <span>A</span> Nonobtrusive Test of the Facial Feedback Hypothesis.”</span> <em>Journal of Personality and Social Psychology</em> 54: 768–77. <a href="https://doi.org/10.1037/0022-3514.54.5.768">https://doi.org/10.1037/0022-3514.54.5.768</a>.
</div>
<div id="ref-standevelopmentteamStanModelingLanguage2021" class="csl-entry" role="listitem">
Team, Stan Development. 2021. <span>“Stan <span>Modeling Language Users Guide</span> and <span>Reference Manual</span>, Version 2.28.”</span> <a href="https://mc-stan.org">https://mc-stan.org</a>.
</div>
<div id="ref-wagenmakersRegisteredReplicationReport2016" class="csl-entry" role="listitem">
Wagenmakers, E.-J., T. Beek, L. Dijkhoff, Q. F. Gronau, A. Acosta, R. B. Adams, D. N. Albohn, et al. 2016. <span>“Registered <span>Replication Report</span>: <span>Strack</span>, <span>Martin</span>, &amp; <span>Stepper</span> (1988).”</span> <em>Perspectives on Psychological Science</em> 11 (6): 917–28. <a href="https://doi.org/10.1177/1745691616674458">https://doi.org/10.1177/1745691616674458</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{vuorre2022,
  author = {Vuorre, Matti},
  title = {ManySmiles Reanalysis},
  date = {2022-11-20},
  url = {https://vuorre.netlify.app/posts/manysmiles-reanalysis},
  langid = {en},
  abstract = {Do people’s facial expressions influence their own
    emotions? In the ManySmiles collaboration, \textasciitilde50
    researchers from 19 countries worked together to find out. In this
    pedagogical example, I reanalyse the ManySmiles dataset by
    estimating incrementally more plausible models to investigate their
    finding’s robustness to various modelling choices. Overall, I
    suggest that large multilab projects, which presumably have some
    resources and human work hours to spare, should investigate the
    analytic robustness of their statistical analyses more carefully.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-vuorre2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Vuorre, Matti. 2022. <span>“ManySmiles Reanalysis.”</span> November 20,
2022. <a href="https://vuorre.netlify.app/posts/manysmiles-reanalysis">https://vuorre.netlify.app/posts/manysmiles-reanalysis</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mvuorre/mvuorre.github.io" data-repo-id="R_kgDOHk4rRg" data-category="giscus" data-category-id="DIC_kwDOHk4rRs4CQAdF" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="light">
</div> <!-- /content -->




</body></html>