<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Sometimes I R</title>
<link>https://sometimesir.com/index.html</link>
<atom:link href="https://sometimesir.com/index.xml" rel="self" type="application/rss+xml"/>
<description>Notes on psychology and statistics, sometimes</description>
<generator>quarto-0.9.584</generator>
<lastBuildDate>Tue, 14 Jun 2022 23:00:00 GMT</lastBuildDate>
<item>
  <title>Easy notifications from R</title>
  <dc:creator>Matti Vuorre</dc:creator>
  <link>https://sometimesir.com/posts/easy-notifications-from-r/index.html</link>
  <description><![CDATA[ 



<p>R can be a pretty slow tool. So it would be good to know when an expensive computation has ended. One way to do that is to have R send a notification to your phone when it is done. Here, I‚Äôll show how to do that easily with <a href="https://ntfy.sh">ntfy</a>.</p>
<section id="download-ntfy.sh" class="level2">
<h2 class="anchored" data-anchor-id="download-ntfy.sh">Download ntfy.sh</h2>
<p>Go to your app store (iOS/Android) and download the ntfy app.</p>
</section>
<section id="subscribe-to-a-topic" class="level2">
<h2 class="anchored" data-anchor-id="subscribe-to-a-topic">Subscribe to a topic</h2>
<p>Open the app on your phone and <a href="https://ntfy.sh/docs/subscribe/phone/">subscribe to a topic</a>. Just type in a name that‚Äôs both memorable and not likely to already be used by someone else. I use <code>vuorre-r-notifications</code>.</p>
<p><img src="https://sometimesir.com/posts/easy-notifications-from-r/images/subscribe.jpeg" class="img-fluid" alt="Subscribing to vuorre-r-notifications on ntfy.sh"></p>
</section>
<section id="send-notifications" class="level2">
<h2 class="anchored" data-anchor-id="send-notifications">Send notifications</h2>
<p>You can now include variations of <code>system("curl -d 'Notification text' ntfy.sh/vuorre-r-notifications")</code> in your R code. For example, to send a notification after a long running code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># Long running code here</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">Sys.sleep</span>(.<span class="dv" style="color: #AD0000;">1</span>)  <span class="co" style="color: #5E5E5E;"># Sleep for .1 second</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;"># Send notification</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">system</span>(<span class="st" style="color: #20794D;">"curl -d 'Woke up after .1 second nap!' ntfy.sh/vuorre-r-notifications"</span>)</span></code></pre></div>
</div>
<p>You‚Äôll get this notification on your phone:</p>
<p><img src="https://sometimesir.com/posts/easy-notifications-from-r/images/notification.jpeg" class="img-fluid" alt="Notification received on phone"></p>
<p>This is really useful when you have simulations (mcmc or otherwise üòâ) that take a long time, and you‚Äôd like to act as soon as they are done. Have fun!</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{vuorre2022,
  author = {Matti Vuorre},
  title = {Easy Notifications from {R}},
  date = {2022-06-15},
  url = {https://sometimesir.com/posts/easy-notifications-from-r},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-vuorre2022" class="csl-entry quarto-appendix-citeas">
Matti Vuorre. 2022. <span>‚ÄúEasy Notifications from R.‚Äù</span> June 15,
2022. <a href="https://sometimesir.com/posts/easy-notifications-from-r">https://sometimesir.com/posts/easy-notifications-from-r</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>tips</category>
  <guid>https://sometimesir.com/posts/easy-notifications-from-r/index.html</guid>
  <pubDate>Tue, 14 Jun 2022 23:00:00 GMT</pubDate>
  <media:content url="https://sometimesir.com/posts/easy-notifications-from-r/images/subscribe.jpeg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Bayesian Meta-Analysis with R, Stan, and brms</title>
  <dc:creator>Matti Vuorre</dc:creator>
  <link>https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis/index.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Recently, there‚Äôs been a lot of talk about meta-analysis, and here I would just like to quickly show that Bayesian multilevel modeling nicely takes care of your meta-analysis needs, and that it is easy to do in R with the rstan and brms packages. As you‚Äôll see, meta-analysis is a special case of Bayesian multilevel modeling when you are unable or unwilling to put a prior distribution on the meta-analytic effect size estimate.</p>
<p>The idea for this post came from Wolfgang Viechtbauer‚Äôs <a href="http://www.metafor-project.org/doku.php/tips:rma_vs_lm_lme_lmer?s%5B%5D=lme4">website</a>, where he compared results for meta-analytic models fitted with his great (frequentist) package <a href="http://www.metafor-project.org/doku.php/metafor">metafor</a> and the swiss army knife of multilevel modeling, <a href="https://cran.r-project.org/web/packages/lme4/index.html">lme4</a>. It turns out that even though you can fit meta-analytic models with lme4, the results are slightly different from traditional meta-analytic models, because the experiment-wise variances are treated slightly differently.</p>
<p>Here are the packages we‚Äôll use:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/packages_43e326fa66c64602900a71de6b7ef011">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(knitr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(kableExtra)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(metafor)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(scales)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(lme4)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;">library</span>(brms)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span></code></pre></div>
</div>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>Here I‚Äôll only focus on a simple random effects meta-analysis of effect sizes, and will use the same example data as in the aforementioned <a href="http://www.metafor-project.org/doku.php/tips:rma_vs_lm_lme_lmer?s%5B%5D=lme4">website</a>. The data are included in the metafor package, and describe the relationship between conscientiousness and medication adherence. The effect sizes are r to z transformed correlations.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/obtain-data_9e42636206d53c6d8aeef44b86a913d1">

</div>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/display-fake-data_7319afe6b279a26ee1374c3d0f0fa4d8">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>Example data (dat.molloy2014 in metafor package).</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> study </th>
   <th style="text-align:right;"> year </th>
   <th style="text-align:right;"> ni </th>
   <th style="text-align:right;"> ri </th>
   <th style="text-align:right;"> yi </th>
   <th style="text-align:right;"> vi </th>
   <th style="text-align:right;"> sei </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Axelsson et al. (2009) </td>
   <td style="text-align:right;"> 2009 </td>
   <td style="text-align:right;"> 109 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Axelsson et al. (2011) </td>
   <td style="text-align:right;"> 2011 </td>
   <td style="text-align:right;"> 749 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bruce et al. (2010) </td>
   <td style="text-align:right;"> 2010 </td>
   <td style="text-align:right;"> 55 </td>
   <td style="text-align:right;"> 0.34 </td>
   <td style="text-align:right;"> 0.35 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.14 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Christensen et al. (1995) </td>
   <td style="text-align:right;"> 1995 </td>
   <td style="text-align:right;"> 72 </td>
   <td style="text-align:right;"> 0.27 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.12 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Christensen et al. (1999) </td>
   <td style="text-align:right;"> 1999 </td>
   <td style="text-align:right;"> 107 </td>
   <td style="text-align:right;"> 0.32 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cohen et al. (2004) </td>
   <td style="text-align:right;"> 2004 </td>
   <td style="text-align:right;"> 65 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.13 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dobbels et al. (2005) </td>
   <td style="text-align:right;"> 2005 </td>
   <td style="text-align:right;"> 174 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.08 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ediger et al. (2007) </td>
   <td style="text-align:right;"> 2007 </td>
   <td style="text-align:right;"> 326 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.06 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Insel et al. (2006) </td>
   <td style="text-align:right;"> 2006 </td>
   <td style="text-align:right;"> 58 </td>
   <td style="text-align:right;"> 0.26 </td>
   <td style="text-align:right;"> 0.27 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.13 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jerant et al. (2011) </td>
   <td style="text-align:right;"> 2011 </td>
   <td style="text-align:right;"> 771 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Moran et al. (1997) </td>
   <td style="text-align:right;"> 1997 </td>
   <td style="text-align:right;"> 56 </td>
   <td style="text-align:right;"> -0.09 </td>
   <td style="text-align:right;"> -0.09 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.14 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> O'Cleirigh et al. (2007) </td>
   <td style="text-align:right;"> 2007 </td>
   <td style="text-align:right;"> 91 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0.39 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.11 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Penedo et al. (2003) </td>
   <td style="text-align:right;"> 2003 </td>
   <td style="text-align:right;"> 116 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.09 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Quine et al. (2012) </td>
   <td style="text-align:right;"> 2012 </td>
   <td style="text-align:right;"> 537 </td>
   <td style="text-align:right;"> 0.15 </td>
   <td style="text-align:right;"> 0.15 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Stilley et al. (2004) </td>
   <td style="text-align:right;"> 2004 </td>
   <td style="text-align:right;"> 158 </td>
   <td style="text-align:right;"> 0.24 </td>
   <td style="text-align:right;"> 0.24 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.08 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Wiebe &amp; Christensen (1997) </td>
   <td style="text-align:right;"> 1997 </td>
   <td style="text-align:right;"> 65 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.13 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">The model</h2>
<p>We are going to fit a random-effects meta-analysis model to these observed effect sizes and their standard errors. Here‚Äôs what this model looks like, loosely following notation from the R package Metafor‚Äôs manual (p.6):</p>
<p><img src="https://latex.codecogs.com/png.latex?y_i%20%5Csim%20N(%5Ctheta_i,%20%5Csigma_i%5E2)"></p>
<p>where each recorded effect size, <img src="https://latex.codecogs.com/png.latex?y_i"> is a draw from a normal distribution which is centered on that study‚Äôs ‚Äútrue‚Äù effect size <img src="https://latex.codecogs.com/png.latex?%5Ctheta_i"> and has standard deviation equal to the study‚Äôs observed standard error <img src="https://latex.codecogs.com/png.latex?%5Csigma_i">.</p>
<p>Our next set of assumptions is that the studies‚Äô true effect sizes approximate some underlying effect size in the (hypothetical) population of all studies. We call this underlying population effect size <img src="https://latex.codecogs.com/png.latex?%5Cmu">, and its standard deviation <img src="https://latex.codecogs.com/png.latex?%5Ctau">, such that the true effect sizes are thus distributed:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctheta_i%20%5Csim%20N(%5Cmu,%20%5Ctau%5E2)"></p>
<p>We now have two interesting parameters: <img src="https://latex.codecogs.com/png.latex?%5Cmu"> tells us, all else being equal, what I may expect the ‚Äútrue‚Äù effect to be, in the population of similar studies. <img src="https://latex.codecogs.com/png.latex?%5Ctau"> tells us how much individual studies of this effect vary.</p>
<p>I think it is most straightforward to write this model as yet another mixed-effects model (metafor manual p.6):</p>
<p><img src="https://latex.codecogs.com/png.latex?y_i%20%5Csim%20N(%5Cmu%20+%20%5Ctheta_i,%20%5Csigma%5E2_i)"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Ctheta_i%20%5Csim%20N(0,%20%5Ctau%5E2)">, studies‚Äô true effects are normally distributed with between-study heterogeneity <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2">. The reason this is a little confusing (to me at least), is that we know the <img src="https://latex.codecogs.com/png.latex?%5Csigma_i">s (this being the fact that separates meta-analysis from other more common regression modeling).</p>
<section id="estimation-with-metafor" class="level3">
<h3 class="anchored" data-anchor-id="estimation-with-metafor">Estimation with metafor</h3>
<p>Super easy!</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-1_8de6250d974b12b734b525f2a7880a47">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">library</span>(metafor)</span>
<span id="cb2-2">ma_out <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">rma</span>(<span class="at" style="color: #657422;">data =</span> dat, <span class="at" style="color: #657422;">yi =</span> yi, <span class="at" style="color: #657422;">sei =</span> sei, <span class="at" style="color: #657422;">slab =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>study)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;">summary</span>(ma_out)</span>
<span id="cb2-4"><span class="do" style="color: #5E5E5E;
font-style: italic;">## </span></span>
<span id="cb2-5"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Random-Effects Model (k = 16; tau^2 estimator: REML)</span></span>
<span id="cb2-6"><span class="do" style="color: #5E5E5E;
font-style: italic;">## </span></span>
<span id="cb2-7"><span class="do" style="color: #5E5E5E;
font-style: italic;">##   logLik  deviance       AIC       BIC      AICc  ‚Äã </span></span>
<span id="cb2-8"><span class="do" style="color: #5E5E5E;
font-style: italic;">##   8.6096  -17.2191  -13.2191  -11.8030  -12.2191   </span></span>
<span id="cb2-9"><span class="do" style="color: #5E5E5E;
font-style: italic;">## </span></span>
<span id="cb2-10"><span class="do" style="color: #5E5E5E;
font-style: italic;">## tau^2 (estimated amount of total heterogeneity): 0.0081 (SE = 0.0055)</span></span>
<span id="cb2-11"><span class="do" style="color: #5E5E5E;
font-style: italic;">## tau (square root of estimated tau^2 value):      0.0901</span></span>
<span id="cb2-12"><span class="do" style="color: #5E5E5E;
font-style: italic;">## I^2 (total heterogeneity / total variability):   61.73%</span></span>
<span id="cb2-13"><span class="do" style="color: #5E5E5E;
font-style: italic;">## H^2 (total variability / sampling variability):  2.61</span></span>
<span id="cb2-14"><span class="do" style="color: #5E5E5E;
font-style: italic;">## </span></span>
<span id="cb2-15"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Test for Heterogeneity:</span></span>
<span id="cb2-16"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Q(df = 15) = 38.1595, p-val = 0.0009</span></span>
<span id="cb2-17"><span class="do" style="color: #5E5E5E;
font-style: italic;">## </span></span>
<span id="cb2-18"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Model Results:</span></span>
<span id="cb2-19"><span class="do" style="color: #5E5E5E;
font-style: italic;">## </span></span>
<span id="cb2-20"><span class="do" style="color: #5E5E5E;
font-style: italic;">## estimate      se    zval    pval   ci.lb   ci.ub     ‚Äã </span></span>
<span id="cb2-21"><span class="do" style="color: #5E5E5E;
font-style: italic;">##   0.1499  0.0316  4.7501  &lt;.0001  0.0881  0.2118  *** </span></span>
<span id="cb2-22"><span class="do" style="color: #5E5E5E;
font-style: italic;">## </span></span>
<span id="cb2-23"><span class="do" style="color: #5E5E5E;
font-style: italic;">## ---</span></span>
<span id="cb2-24"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
</section>
</section>
<section id="bayesian-estimation" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-estimation">Bayesian estimation</h2>
<p>So far so good, we‚Äôre strictly in the realm of standard meta-analysis. But I would like to propose that instead of using custom meta-analysis software, we simply consider the above model as just another regression model, and fit it like we would any other (multilevel) regression model. That is, using <a href="http://mc-stan.org/">Stan</a>, usually through the <a href="https://cran.r-project.org/package=brms">brms</a> interface. Going Bayesian allows us to assign prior distributions on the population-level parameters <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?%5Ctau">, and we would usually want to use some very mildly regularizing priors. Here we proceed with brms‚Äô default priors (which I print below with the output)</p>
<section id="estimation-with-brms" class="level3">
<h3 class="anchored" data-anchor-id="estimation-with-brms">Estimation with brms</h3>
<p>Here‚Äôs how to fit this model with brms:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/fit-ma-brms_a697bad10c015e4f6f661029504bf246">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">brm_out <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">brm</span>(</span>
<span id="cb3-2">  yi <span class="sc" style="color: #5E5E5E;">|</span> <span class="fu" style="color: #4758AB;">se</span>(sei) <span class="sc" style="color: #5E5E5E;">~</span> <span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">+</span> (<span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">|</span> study), </span>
<span id="cb3-3">  <span class="at" style="color: #657422;">data =</span> dat, </span>
<span id="cb3-4">  <span class="at" style="color: #657422;">cores =</span> <span class="dv" style="color: #AD0000;">4</span>,</span>
<span id="cb3-5">  <span class="at" style="color: #657422;">file =</span> <span class="st" style="color: #20794D;">"metaanalysismodel"</span></span>
<span id="cb3-6">)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/results-disp_eba04825fdc1e5e076ce884587958839">
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: yi | se(sei) ~ 1 + (1 | study) 
##    Data: dat (Number of observations: 16) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Priors: 
## Intercept ~ student_t(3, 0.2, 2.5)
## &lt;lower=0&gt; sd ~ student_t(3, 0, 2.5)
## 
## Group-Level Effects: 
## ~study (Number of levels: 16) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.10      0.04     0.04     0.19 1.00     1377     1924
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.15      0.04     0.08     0.22 1.00     1826     2015
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.00      0.00     0.00     0.00   NA       NA       NA
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<p>These results are the same as the ones obtained with metafor. Note the Student‚Äôs <em>t</em> prior distributions, which are diffuse enough not to exert influence on the posterior distribution.</p>
</section>
</section>
<section id="comparing-results" class="level2">
<h2 class="anchored" data-anchor-id="comparing-results">Comparing results</h2>
<p>We can now compare the results of these two estimation methods. Of course, the Bayesian method has a tremendous advantage, because it results in a full distribution of plausible values.</p>
<div class="cell" data-layout-align="center" data-preview="true" data-hash="index_cache/html/unnamed-chunk-2_81877cd9b64032094068d926ebc097f9">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><p></p>
</figure>
</div>
</div>
</div>
<p>We can see from the numeric output, and especially the figures, that these modes of inference yield the same numerical results. Keep in mind though, that the Bayesian estimates actually allow you to discuss probabilities, and generally the things that we‚Äôd like to discuss when talking about results.</p>
<p>For example, what is the probability that the average effect size is greater than 0.2? About eight percent:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-3_ea0fd8b7960792f1a1972b30dabad773">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">hypothesis</span>(brm_out, <span class="st" style="color: #20794D;">"Intercept &gt; 0.2"</span>)</span>
<span id="cb5-2"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Hypothesis Tests for class b:</span></span>
<span id="cb5-3"><span class="do" style="color: #5E5E5E;
font-style: italic;">##              Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star</span></span>
<span id="cb5-4"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 1 (Intercept)-(0.2) &gt; 0    -0.05      0.04    -0.11     0.01       0.09      0.08     </span></span>
<span id="cb5-5"><span class="do" style="color: #5E5E5E;
font-style: italic;">## ---</span></span>
<span id="cb5-6"><span class="do" style="color: #5E5E5E;
font-style: italic;">## 'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.</span></span>
<span id="cb5-7"><span class="do" style="color: #5E5E5E;
font-style: italic;">## '*': For one-sided hypotheses, the posterior probability exceeds 95%;</span></span>
<span id="cb5-8"><span class="do" style="color: #5E5E5E;
font-style: italic;">## for two-sided hypotheses, the value tested against lies outside the 95%-CI.</span></span>
<span id="cb5-9"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Posterior probabilities of point hypotheses assume equal prior probabilities.</span></span></code></pre></div>
</div>
<section id="forest-plot" class="level3">
<h3 class="anchored" data-anchor-id="forest-plot">Forest plot</h3>
<p>The forest plot displays the entire posterior distribution of each <img src="https://latex.codecogs.com/png.latex?%5Ctheta_i">. The meta-analytic effect size <img src="https://latex.codecogs.com/png.latex?%5Cmu"> is also displayed in the bottom row. I‚Äôll show a considerable amount of code here so that you can create your own forest plots from brms output:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/draw-forest-plot_c844276a86710c6650f9b1ff4e93672b">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">library</span>(tidybayes)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">library</span>(ggdist)</span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;"># Study-specific effects are deviations + average</span></span>
<span id="cb6-4">out_r <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">spread_draws</span>(brm_out, r_study[study,term], b_Intercept) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">b_Intercept =</span> r_study <span class="sc" style="color: #5E5E5E;">+</span> b_Intercept) </span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;"># Average effect</span></span>
<span id="cb6-7">out_f <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">spread_draws</span>(brm_out, b_Intercept) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">study =</span> <span class="st" style="color: #20794D;">"Average"</span>)</span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;"># Combine average and study-specific effects' data frames</span></span>
<span id="cb6-10">out_all <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">bind_rows</span>(out_r, out_f) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-12">  <span class="co" style="color: #5E5E5E;"># Ensure that Average effect is on the bottom of the forest plot</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">study =</span> <span class="fu" style="color: #4758AB;">fct_relevel</span>(study, <span class="st" style="color: #20794D;">"Average"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-14">  <span class="co" style="color: #5E5E5E;"># tidybayes garbles names so fix here</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">study =</span> <span class="fu" style="color: #4758AB;">str_replace_all</span>(study, <span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">."</span>, <span class="st" style="color: #20794D;">" "</span>))</span>
<span id="cb6-16"><span class="co" style="color: #5E5E5E;"># Data frame of summary numbers</span></span>
<span id="cb6-17">out_all_sum <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">group_by</span>(out_all, study) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-18">  <span class="fu" style="color: #4758AB;">mean_qi</span>(b_Intercept)</span>
<span id="cb6-19"><span class="co" style="color: #5E5E5E;"># Draw plot</span></span>
<span id="cb6-20">out_all <span class="sc" style="color: #5E5E5E;">%&gt;%</span>   </span>
<span id="cb6-21">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(b_Intercept, study)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-22">  <span class="co" style="color: #5E5E5E;"># Zero!</span></span>
<span id="cb6-23">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">size =</span> .<span class="dv" style="color: #AD0000;">25</span>, <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-24">  <span class="fu" style="color: #4758AB;">stat_halfeye</span>(<span class="at" style="color: #657422;">.width =</span> <span class="fu" style="color: #4758AB;">c</span>(.<span class="dv" style="color: #AD0000;">8</span>, .<span class="dv" style="color: #AD0000;">95</span>), <span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"dodgerblue"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-25">  <span class="co" style="color: #5E5E5E;"># Add text labels</span></span>
<span id="cb6-26">  <span class="fu" style="color: #4758AB;">geom_text</span>(</span>
<span id="cb6-27">    <span class="at" style="color: #657422;">data =</span> <span class="fu" style="color: #4758AB;">mutate_if</span>(out_all_sum, is.numeric, round, <span class="dv" style="color: #AD0000;">2</span>),</span>
<span id="cb6-28">    <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"{b_Intercept} [{.lower}, {.upper}]"</span>), <span class="at" style="color: #657422;">x =</span> <span class="fl" style="color: #AD0000;">0.75</span>),</span>
<span id="cb6-29">    <span class="at" style="color: #657422;">hjust =</span> <span class="st" style="color: #20794D;">"inward"</span></span>
<span id="cb6-30">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-31">  <span class="co" style="color: #5E5E5E;"># Observed as empty points</span></span>
<span id="cb6-32">  <span class="fu" style="color: #4758AB;">geom_point</span>(</span>
<span id="cb6-33">    <span class="at" style="color: #657422;">data =</span> dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">study =</span> <span class="fu" style="color: #4758AB;">str_replace_all</span>(study, <span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">."</span>, <span class="st" style="color: #20794D;">" "</span>)), </span>
<span id="cb6-34">    <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>yi), <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_nudge</span>(<span class="at" style="color: #657422;">y =</span> <span class="sc" style="color: #5E5E5E;">-</span>.<span class="dv" style="color: #AD0000;">2</span>), <span class="at" style="color: #657422;">shape =</span> <span class="dv" style="color: #AD0000;">1</span> </span>
<span id="cb6-35">  )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis/index_files/figure-html/draw-forest-plot-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><p></p>
</figure>
</div>
</div>
</div>
<p>Focus on Moran et al.&nbsp;(1997)‚Äôs observed effect size (the empty circle): This is an anomalous result compared to all other studies. One might describe it as <em>incredible</em>, and that is indeed what the bayesian estimation procedure has done, and the resulting posterior distribution is no longer equivalent to the observed effect size. Instead, it is shrunken toward the average effect size. Now look at the table above, this study only had 56 participants, so we should be more skeptical of this study‚Äôs observed ES, and perhaps we should then adjust our beliefs about this study in the context of other studies. Therefore, our best guess about this study‚Äôs effect size, given all the other studies is no longer the observed mean, but something closer to the average across the studies.</p>
<p>If this shrinkage business seems radical, consider Quine et al.&nbsp;(2012). This study had a much greater sample size (537), and therefore a smaller SE. It was also generally more in line with the average effect size estimate. Therefore, the observed mean ES and the mean of the posterior distribution are pretty much identical. This is also a fairly desirable feature.</p>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>The way these different methods are presented (regression, meta-analysis, ANOVA, ‚Ä¶), it is quite easy for a beginner, like me, to lose sight of the forest for the trees. I also feel that this is a general experience for students of applied statistics: Every experiment, situation, and question results in a different statistical method (or worse: ‚ÄúWhich test should I use?‚Äù), and the student doesn‚Äôt see how the methods relate to each other. So I think focusing on the (regression) model is key, but often overlooked in favor of this sort of decision tree model of choosing statistical methods <span class="citation" data-cites="mcelreathStatisticalRethinkingBayesian2020">(McElreath 2020)</span>.</p>
<p>Accordingly, I think we‚Äôve ended up in a situation where meta-analysis, for example, is seen as somehow separate from all the other modeling we do, such as repeated measures t-tests. In fact I think applied statistics in Psychology may too often appear as an unconnected bunch of tricks and models, leading to confusion and inefficient implementation of appropriate methods.</p>
<section id="bayesian-multilevel-modeling" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-multilevel-modeling">Bayesian multilevel modeling</h3>
<p>As I‚Äôve been learning more about statistics, I‚Äôve often noticed that some technique, applied in a specific set of situations, turns out to be a special case of a more general modeling approach. I‚Äôll call this approach here <em>Bayesian multilevel modeling</em> <span class="citation" data-cites="mcelreathStatisticalRethinkingBayesian2020">(McElreath 2020)</span>. If you are forced to choose one statistical method to learn, it should be Bayesian multilevel modeling, because it allows you to do and understand most things, and allows you to see how similar all these methods are, under the hood.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry">
McElreath, Richard. 2020. <em>Statistical Rethinking: A <span>Bayesian</span> Course with Examples in <span>R</span> and <span>Stan</span></em>. Second. <span>CRC</span> Texts in Statistical Science. <span>Boca Raton</span>: <span>Taylor and Francis, CRC Press</span>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{vuorre2016,
  author = {Matti Vuorre},
  title = {Bayesian {Meta-Analysis} with {R,} {Stan,} and Brms},
  date = {2016-09-29},
  url = {https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-vuorre2016" class="csl-entry quarto-appendix-citeas">
Matti Vuorre. 2016. <span>‚ÄúBayesian Meta-Analysis with R, Stan, and
Brms.‚Äù</span> September 29, 2016. <a href="https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis">https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis</a>.
</div></div></section></div> ]]></description>
  <category>statistics</category>
  <category>R</category>
  <category>brms</category>
  <category>tutorial</category>
  <guid>https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis/index.html</guid>
  <pubDate>Wed, 28 Sep 2016 23:00:00 GMT</pubDate>
  <media:content url="https://sometimesir.com/posts/2016-09-29-bayesian-meta-analysis/index_files/figure-html/unnamed-chunk-2-1.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Confidence intervals in multilevel models</title>
  <dc:creator>Matti Vuorre</dc:creator>
  <link>https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index.html</link>
  <description><![CDATA[ 



<p>In this post, I address the following problem: How to obtain regression lines and their associated confidence intervals at the average and individual-specific levels, in a two-level multilevel linear regression.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Visualization is perhaps the most effective way of communicating the results of a statistical model. For regression models, two figures are commonly used: The coefficient plot shows the coefficients of a model graphically, and can be used to replace or augment a model summary table. The advantage over tables is that it is usually faster to understand the estimated parameters by looking at them in graphical form, but the downside is losing the numerical accuracy of the table. However, both of these model summaries become increasingly difficult to interpret as the number of coefficients increases, and especially when interaction terms are included.</p>
<p>An alternative visualization is the line plot, which shows what the model implies in terms of the data, such as the relationship between X and Y, and perhaps how that relationship is moderated by other variables. For a linear regression, this plot displays the regression line and its confidence interval. If a confidence interval is not shown, the plot is not complete because the viewer can‚Äôt visually assess the uncertainty in the regression line, and therefore a simple line without a confidence interval is of little inferential value. Obtaining the line and confidence interval for simple linear regression is very easy, but is not straightforward in a multilevel context, the topic of this post.</p>
<p>Most of my statistical analyses utilize multilevel modeling, where parameters (means, slopes) are treated as varying between individuals. Because common procedures for estimating these models return point estimates for the regression coefficients at all levels, drawing expected regression lines is easy. However, displaying the confidence limits for the regression lines is not as easily done. Various options exist, and some software packages provide these limits automatically, but in this post I want to highlight a completely general approach to obtaining and drawing confidence limits for regression lines at multiple levels of analysis, and where applicable, show how various packages deliver them automatically. This general approach is inference based on probability, or bayesian statistics. In practice, obtaining random samples from the posterior distribution makes it easy to compute values such as confidence limits for any quantity of interest. Importantly, we can summarize the samples with an interval at each level of the predictor values, yielding the confidence interval for the regression line.</p>
<p>I will illustrate the procedure first with a maximum likelihood model fitting procedure, using the lme4 package. This procedure requires an additional step where plausible parameter values are simulated from the estimated model, using the arm package. Then, I‚Äôll show how to obtain the limits from models estimated with Bayesian methods, using the brms R package.</p>
<p>We‚Äôll use the following R packages:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/packages_fabda9916eb57c579547e866e603c024">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(knitr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(lme4)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(here)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(arm)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(broom.mixed)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;">library</span>(kableExtra)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;">library</span>(patchwork)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;">library</span>(brms)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span></code></pre></div>
</div>
</section>
<section id="example-data" class="level2">
<h2 class="anchored" data-anchor-id="example-data">Example Data</h2>
<p>I will use the <code>sleepstudy</code> data set from the <code>lme4</code> package as an example:</p>
<blockquote class="blockquote">
<p>‚ÄúThe average reaction time per day for subjects in a sleep deprivation study. On day 0 the subjects had their normal amount of sleep. Starting that night they were restricted to 3 hours of sleep per night. The observations represent the average reaction time on a series of tests given each day to each subject.‚Äù</p>
</blockquote>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/exdata_4ac3e4078eecfe60c01d65f62b357aac">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">sleepstudy <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as_tibble</span>(sleepstudy)</span></code></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>Example data</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> Reaction </th>
   <th style="text-align:right;"> Days </th>
   <th style="text-align:left;"> Subject </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 249.56 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 308 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 258.70 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 308 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 250.80 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 308 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 321.44 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> 308 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 356.85 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> 308 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 414.69 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> 308 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>The data is structured in a long format, where each row contains all variables at a single measurement instance.</p>
</section>
<section id="fixed-effects-models-and-cis" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="fixed-effects-models-and-cis">Fixed Effects Models and CIs</h2>
<p>Below, I show two kinds of scatterplots from the data. The left one represents a fixed effects regression, where information about individuals is discarded, and all that is left is a lonely band of inference in a sea of scattered observations. The right panel shows fixed effects regressions separately for each individual.</p>
<div class="cell page-columns page-full" data-layout-align="center" data-preview="true" data-hash="index_cache/html/fig1and2_69a0102f45c0a762a7235e6b562fd06b">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">p1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">ggplot</span>(sleepstudy, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> Days, <span class="at" style="color: #657422;">y =</span> Reaction)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">shape =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">breaks =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">3</span>, <span class="dv" style="color: #AD0000;">6</span>, <span class="dv" style="color: #AD0000;">9</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"lm"</span>, <span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"dodgerblue"</span>, <span class="at" style="color: #657422;">level =</span> .<span class="dv" style="color: #AD0000;">95</span>)</span>
<span id="cb3-5">p2 <span class="ot" style="color: #003B4F;">&lt;-</span> p1 <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>Subject, <span class="at" style="color: #657422;">nrow =</span> <span class="dv" style="color: #AD0000;">4</span>)</span>
<span id="cb3-6">p1 <span class="sc" style="color: #5E5E5E;">|</span> p2</span></code></pre></div>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/fig1and2-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><p></p>
</figure>
</div>
</div>
</div>
<p>Obtaining confidence intervals for regression lines using ggplot2 is easy (<code>geom_smooth()</code> gives them by default), but an alternative way is to explicitly use the <code>predict()</code> function (which ggplot2 uses under the hood). For more complicated or esoteric models, explicit prediction becomes necessary, either using <code>predict()</code> or custom code.</p>
</section>
<section id="multilevel-model" class="level2">
<h2 class="anchored" data-anchor-id="multilevel-model">Multilevel model</h2>
<p>The multilevel model I‚Äôll fit to these data treats the intercept and effect of days as varying between individuals</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathsf%7Breaction%7D_%7Bij%7D%20%5Csim%20%5Cmathcal%7BN%7D(%5Cmu_%7Bij%7D,%20%5Csigma)"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmu_%7Bij%7D%20=%20%5Cbeta_%7B0j%7D%20+%20%5Cbeta_%7B1j%7D%20%5C%20%20%5Cmathsf%7Bdays%7D_%7Bij%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Bpmatrix%7D%7B%5Cbeta_%7B0j%7D%7D%5C%5C%7B%5Cbeta_%7B1j%7D%7D%5Cend%7Bpmatrix%7D%20%5Csim%0A%5Cmathcal%7BN%7D%20%5Cbegin%7Bpmatrix%7D%7B%5Cgamma_%7B00%7D%7D,%5C%20%7B%5Ctau_%7B00%7D%7D%5C%20%7B%5Crho_%7B01%7D%7D%5C%5C%0A%7B%5Cgamma_%7B10%7D%7D,%5C%20%7B%5Crho_%7B01%7D%7D%5C%20%7B%5Ctau_%7B10%7D%7D%20%5Cend%7Bpmatrix%7D"></p>
<p>In this post, and the above equations, I‚Äôll omit the discussion of hyperpriors (priors on <img src="https://latex.codecogs.com/png.latex?%5Cgamma">, <img src="https://latex.codecogs.com/png.latex?%5Ctau"> and <img src="https://latex.codecogs.com/png.latex?%5Crho"> parameters.)</p>
<p>If the above equations baffle the mind, or multilevel models are mysterious to you, <span class="citation" data-cites="bolgerIntensiveLongitudinalMethods2013">Bolger and Laurenceau (2013)</span> and <span class="citation" data-cites="gelmanDataAnalysisUsing2007">Gelman and Hill (2007)</span> are great introductions to the topic.</p>
</section>
<section id="maximum-likelihood-estimation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="maximum-likelihood-estimation">Maximum likelihood estimation</h2>
<p>I‚Äôll estimate the multilevel model using the lme4 package.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/fitlmer_2b785618fc12cf8cdda49c8e3fec4e58">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">lmerfit <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>(Reaction <span class="sc" style="color: #5E5E5E;">~</span> Days <span class="sc" style="color: #5E5E5E;">+</span> (Days <span class="sc" style="color: #5E5E5E;">|</span> Subject), <span class="at" style="color: #657422;">data =</span> sleepstudy)</span></code></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>Multilevel model summary</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> effect </th>
   <th style="text-align:left;"> term </th>
   <th style="text-align:right;"> estimate </th>
   <th style="text-align:right;"> statistic </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> fixed </td>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 251.41 </td>
   <td style="text-align:right;"> 36.84 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> fixed </td>
   <td style="text-align:left;"> Days </td>
   <td style="text-align:right;"> 10.47 </td>
   <td style="text-align:right;"> 6.77 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>The key points here are the estimates and their associated standard errors, the latter of which are missing for the varying effects‚Äô correlations and standard deviations.</p>
<section id="working-with-point-estimates" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="working-with-point-estimates">Working with point estimates</h3>
<p>Using the model output, we can generate regression lines using the <code>predict()</code> function. Using this method, we can simply add a new column to the existing <code>sleepstudy</code> data frame, giving the fitted value for each row in the data. However, for visualization, it is very useful to generate the fitted values for specific combinations of predictor values, instead of generating a fitted value for every observation. To do this, I simply create dataframes with the relevant predictors, and feed these data frames as data to <code>predict()</code>.</p>
<p>To get fitted values at the average level, when there is only one predictor, the data frame is simply a column with rows for each level of <code>Days</code>. For the varying effects, I create a data frame where each individual has all levels of <code>Days</code>, using the <code>expand.grid()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/pred_lmer_8da706581dfa545b79ad6d470769cc6e">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;"># Data frame to evaluate average effects predictions on</span></span>
<span id="cb5-2">newavg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">Days =</span> <span class="dv" style="color: #AD0000;">0</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>)</span>
<span id="cb5-3">newavg<span class="sc" style="color: #5E5E5E;">$</span>Reaction <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">predict</span>(lmerfit, <span class="at" style="color: #657422;">re.form =</span> <span class="cn" style="color: #8f5902;">NA</span>, newavg)</span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;"># Predictors for the varying effect's predictions</span></span>
<span id="cb5-5">newvary <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">expand.grid</span>(<span class="at" style="color: #657422;">Days =</span> <span class="dv" style="color: #AD0000;">0</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">Subject =</span> <span class="fu" style="color: #4758AB;">unique</span>(sleepstudy<span class="sc" style="color: #5E5E5E;">$</span>Subject))</span>
<span id="cb5-6">newvary<span class="sc" style="color: #5E5E5E;">$</span>Reaction <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">predict</span>(lmerfit, newvary)</span></code></pre></div>
</div>
<p>I‚Äôll show these predictions within the previous figures: On the left, a single fixed effects model versus the average regression line from the new multilevel model, and on the right the separate fixed effects models versus the varying regression lines from the multilevel model. Below, I use blue colors to indicate the fixed effects models‚Äô predictions, and black for the multilevel model‚Äôs predictions.</p>
<div class="cell page-columns page-full" data-layout-align="center" data-hash="index_cache/html/plotlmer_655fa3da1282a64d9175f5cd45750e35">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">p1 <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> newavg, <span class="at" style="color: #657422;">col =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">|</span></span>
<span id="cb6-2">  p2 <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> newvary, <span class="at" style="color: #657422;">col =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>)</span></code></pre></div>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/plotlmer-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>As you can probably tell, the fixed effects regression line (blue), and the multilevel model‚Äôs average regression line (black; left panel) are identical, because of the completely balanced design. However, interesting differences are apparent in the right panel: The varying effects‚Äô regression lines are different from the separate fixed effects models‚Äô regression lines. How? They are ‚Äúshrunk‚Äù toward the average-level estimate. Focus on subject 335, an individual whose reaction times got faster with increased sleep deprivation:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/plotlmerid9_1d4c8fb4df70af98247367e04bc39647">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">p2 <span class="sc" style="color: #5E5E5E;">%+%</span> <span class="fu" style="color: #4758AB;">filter</span>(sleepstudy, Subject <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">335</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> <span class="fu" style="color: #4758AB;">filter</span>(newvary, Subject <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">335</span>), <span class="at" style="color: #657422;">col =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/plotlmerid9-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>Estimating each participant‚Äôs data in their very own model (separate fixed effects models) resulted in a predicted line suggesting to us that this person‚Äôs cognitive performance is enhanced following sleep deprivation (blue line with negative slope).</p>
<p>However, if we used a model where this individual was treated as a random draw from a population of individuals (the multilevel model; black line in the above figure), the story is different. The point estimate for the slope parameter, for this specific individual, from this model (-0.28) tells us that the estimated decrease in reaction times is quite a bit smaller. But this is just a point estimate, and in order to draw inference, we‚Äôll need standard errors, or some representation of the uncertainty, in the estimated parameters. The appropriate uncertainty representations will also allow us to draw the black lines with their associated confidence intervals. I‚Äôll begin by obtaining a confidence interval for the average regression line.</p>
</section>
<section id="cis-using-arm-average-level" class="level3">
<h3 class="anchored" data-anchor-id="cis-using-arm-average-level">CIs using arm: Average level</h3>
<p>The method I will illustrate in this post relies on random samples of plausible parameter values, from which we can then generate regression lines‚Äìor draw inferences about the parameters themselves. These regression lines can then be used as their own distribution with their own respective summaries, such as an X% interval. First, I‚Äôll show a quick way for obtaining these samples for the lme4 model, using the arm package to generate simulated parameter values.</p>
<p>The important parts of this code are:</p>
<ol type="1">
<li>Simulating plausible parameter values</li>
<li>Saving the simulated samples (a faux posterior distribution) in a data frame</li>
<li>Creating a predictor matrix</li>
<li>Creating a matrix for the fitted values</li>
<li>Calculating fitted values for each combination of the predictor values, for each plausible combination of the parameter values</li>
<li>Calculating the desired quantiles of the fitted values</li>
</ol>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/sim_lmer_0798af5b7cdbb03f041114941331f993">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">sims <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">sim</span>(lmerfit, <span class="at" style="color: #657422;">n.sims =</span> <span class="dv" style="color: #AD0000;">1000</span>) <span class="co" style="color: #5E5E5E;"># 1</span></span>
<span id="cb8-2">fs <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fixef</span>(sims) <span class="co" style="color: #5E5E5E;"># 2</span></span>
<span id="cb8-3">newavg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">Days =</span> <span class="dv" style="color: #AD0000;">0</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>)</span>
<span id="cb8-4">Xmat <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">model.matrix</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">+</span> Days, <span class="at" style="color: #657422;">data =</span> newavg) <span class="co" style="color: #5E5E5E;"># 3</span></span>
<span id="cb8-5">fitmat <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">matrix</span>(<span class="at" style="color: #657422;">ncol =</span> <span class="fu" style="color: #4758AB;">nrow</span>(fs), <span class="at" style="color: #657422;">nrow =</span> <span class="fu" style="color: #4758AB;">nrow</span>(newavg)) <span class="co" style="color: #5E5E5E;"># 4</span></span>
<span id="cb8-6"><span class="cf" style="color: #003B4F;">for</span> (i <span class="cf" style="color: #003B4F;">in</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">nrow</span>(fs)) {</span>
<span id="cb8-7">  fitmat[, i] <span class="ot" style="color: #003B4F;">&lt;-</span> Xmat <span class="sc" style="color: #5E5E5E;">%*%</span> <span class="fu" style="color: #4758AB;">as.matrix</span>(fs)[i, ]</span>
<span id="cb8-8">} <span class="co" style="color: #5E5E5E;"># 5</span></span>
<span id="cb8-9">newavg<span class="sc" style="color: #5E5E5E;">$</span>lower <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">apply</span>(fitmat, <span class="dv" style="color: #AD0000;">1</span>, quantile, <span class="at" style="color: #657422;">prob =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="co" style="color: #5E5E5E;"># 6</span></span>
<span id="cb8-10">newavg<span class="sc" style="color: #5E5E5E;">$</span>median <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">apply</span>(fitmat, <span class="dv" style="color: #AD0000;">1</span>, quantile, <span class="at" style="color: #657422;">prob =</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="co" style="color: #5E5E5E;"># 6</span></span>
<span id="cb8-11">newavg<span class="sc" style="color: #5E5E5E;">$</span>upper <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">apply</span>(fitmat, <span class="dv" style="color: #AD0000;">1</span>, quantile, <span class="at" style="color: #657422;">prob =</span> <span class="fl" style="color: #AD0000;">0.95</span>) <span class="co" style="color: #5E5E5E;"># 6</span></span>
<span id="cb8-12">p1 <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> newavg, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> median), <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> newavg, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> lower), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-14">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> newavg, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> upper), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/sim_lmer-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>Again, the multilevel model‚Äôs average regression line and the fixed effect model‚Äôs regression line are identical, but the former has a wider confidence interval (black dashed lines.)</p>
<p>The code snippet generalizes well to be used with any two matrices where one contains predictor values (the combinations of predictor values on which you want to predict) and the other samples of parameter values, such as a posterior distribution from a Bayesian model, as we‚Äôll see below. This procedure is described in <span class="citation" data-cites="korner-nievergeltBayesianDataAnalysis2015">Korner-Nievergelt et al. (2015)</span>, who give a detailed explanation of the code and on drawing inference from the results.</p>
</section>
<section id="cis-using-arm-individual-level" class="level3">
<h3 class="anchored" data-anchor-id="cis-using-arm-individual-level">CIs using arm: Individual level</h3>
<p>The <code>fitted()</code> function in arm returns fitted values at the varying effects level automatically, so we can skip a few lines of code from above to obtain confidence intervals at the individual-level:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/plot_lmer_vary_c47d0020b85ec8172db56c531485a5a2">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">yhat <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fitted</span>(sims, lmerfit)</span>
<span id="cb9-2">sleepstudy<span class="sc" style="color: #5E5E5E;">$</span>lower <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">apply</span>(yhat, <span class="dv" style="color: #AD0000;">1</span>, quantile, <span class="at" style="color: #657422;">prob =</span> <span class="fl" style="color: #AD0000;">0.025</span>)</span>
<span id="cb9-3">sleepstudy<span class="sc" style="color: #5E5E5E;">$</span>median <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">apply</span>(yhat, <span class="dv" style="color: #AD0000;">1</span>, quantile, <span class="at" style="color: #657422;">prob =</span> <span class="fl" style="color: #AD0000;">0.5</span>)</span>
<span id="cb9-4">sleepstudy<span class="sc" style="color: #5E5E5E;">$</span>upper <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">apply</span>(yhat, <span class="dv" style="color: #AD0000;">1</span>, quantile, <span class="at" style="color: #657422;">prob =</span> <span class="fl" style="color: #AD0000;">0.975</span>)</span>
<span id="cb9-5">p2 <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> sleepstudy, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> median), <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> sleepstudy, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> lower), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> sleepstudy, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> upper), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/plot_lmer_vary-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A subset of individuals highlights the most interesting differences between the models:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/plot_lmer_vary_id9_3236d149fa262c4f31664b8d2e135b23">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">tmp <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter</span>(sleepstudy, Subject <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">unique</span>(sleepstudy<span class="sc" style="color: #5E5E5E;">$</span>Subject)[<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">6</span>, <span class="dv" style="color: #AD0000;">9</span>)])</span>
<span id="cb10-2">p2 <span class="sc" style="color: #5E5E5E;">%+%</span> tmp <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> tmp, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> median), <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> tmp, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> lower), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> tmp, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> upper), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/plot_lmer_vary_id9-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>In the top panel, the unique fixed effects model‚Äôs confidence band is much wider than the confidence band from the multilevel model, highlighting the pooling of information in the latter model. Similarly, the bottom panel (individual 9 discussed above) shows that 95% plausible regression lines for that individual now include lines that increase as a function of days of sleep deprivation, and indeed the expected regression line for this individual is nearly a flat line.</p>
<p>In the next sections, we‚Äôll apply this method of obtaining regression line confidence intervals for multilevel models estimated with Bayesian methods.</p>
</section>
</section>
<section id="intervals-from-bayesian-models" class="level2">
<h2 class="anchored" data-anchor-id="intervals-from-bayesian-models">Intervals from Bayesian models</h2>
<p>Confidence intervals are commonly called credible intervals in the Bayesian context, but I‚Äôll use these terms interchangeably. The reader should be aware that, unlike traditional confidence intervals, credible intervals actually allow statements about credibility. In fact, being allowed to say the things we usually mean when discussing confidence intervals is one of many good reasons for applying bayesian statistics.</p>
<p>I use brms to specify the model and sample from the posterior distribution.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/fit_brms_ead1148c0159b5a7bc47ea900d55ef9a">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">brmfit <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">brm</span>(</span>
<span id="cb11-2">  <span class="at" style="color: #657422;">data =</span> sleepstudy,</span>
<span id="cb11-3">  Reaction <span class="sc" style="color: #5E5E5E;">~</span> Days <span class="sc" style="color: #5E5E5E;">+</span> (Days <span class="sc" style="color: #5E5E5E;">|</span> Subject),</span>
<span id="cb11-4">  <span class="at" style="color: #657422;">family =</span> gaussian,</span>
<span id="cb11-5">  <span class="at" style="color: #657422;">iter =</span> <span class="dv" style="color: #AD0000;">2000</span>,</span>
<span id="cb11-6">  <span class="at" style="color: #657422;">chains =</span> <span class="dv" style="color: #AD0000;">4</span>,</span>
<span id="cb11-7">  <span class="at" style="color: #657422;">file =</span> <span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"models/sleepstudy"</span>)</span>
<span id="cb11-8">)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/printbrmfit_545a213d0e691b63d585a7677a1ed8dd">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>Bayesian model estimates (brms)</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Estimate </th>
   <th style="text-align:right;"> Est.Error </th>
   <th style="text-align:right;"> l-95% CI </th>
   <th style="text-align:right;"> u-95% CI </th>
   <th style="text-align:right;"> Tail_ESS </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Intercept </td>
   <td style="text-align:right;"> 251.21 </td>
   <td style="text-align:right;"> 7.54 </td>
   <td style="text-align:right;"> 236.94 </td>
   <td style="text-align:right;"> 266.40 </td>
   <td style="text-align:right;"> 2637.14 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Days </td>
   <td style="text-align:right;"> 10.30 </td>
   <td style="text-align:right;"> 1.74 </td>
   <td style="text-align:right;"> 6.73 </td>
   <td style="text-align:right;"> 13.64 </td>
   <td style="text-align:right;"> 1575.23 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> sd(Intercept) </td>
   <td style="text-align:right;"> 26.89 </td>
   <td style="text-align:right;"> 6.78 </td>
   <td style="text-align:right;"> 15.86 </td>
   <td style="text-align:right;"> 42.19 </td>
   <td style="text-align:right;"> 2467.71 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> sd(Days) </td>
   <td style="text-align:right;"> 6.67 </td>
   <td style="text-align:right;"> 1.59 </td>
   <td style="text-align:right;"> 4.21 </td>
   <td style="text-align:right;"> 10.35 </td>
   <td style="text-align:right;"> 1356.55 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cor(Intercept,Days) </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.30 </td>
   <td style="text-align:right;"> -0.47 </td>
   <td style="text-align:right;"> 0.66 </td>
   <td style="text-align:right;"> 1472.98 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Note that now we also have values for the uncertainties associated with the varying effect parameters, without additional code.</p>
<section id="average-regression-line-ci" class="level4">
<h4 class="anchored" data-anchor-id="average-regression-line-ci">Average regression line &amp; CI</h4>
<p>brms has a function for obtaining fitted values (<code>fitted()</code>) and their associated upper and lower bounds, which together constitute the regression line and its confidence interval.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/plot_brm_avg_84f4a41bc5a44ff1852d725af2df4164">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">newavg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">Days =</span> <span class="dv" style="color: #AD0000;">0</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>)</span>
<span id="cb12-2">fitavg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">cbind</span>(</span>
<span id="cb12-3">  newavg, </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">fitted</span>(brmfit, <span class="at" style="color: #657422;">newdata =</span> newavg, <span class="at" style="color: #657422;">re_formula =</span> <span class="cn" style="color: #8f5902;">NA</span>)[, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">2</span>]</span>
<span id="cb12-5">  )</span>
<span id="cb12-6">p3 <span class="ot" style="color: #003B4F;">&lt;-</span> p1 <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> fitavg, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> Estimate), <span class="at" style="color: #657422;">col =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> fitavg, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> Q2<span class="fl" style="color: #AD0000;">.5</span>), <span class="at" style="color: #657422;">col =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> fitavg, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> Q97<span class="fl" style="color: #AD0000;">.5</span>), <span class="at" style="color: #657422;">col =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb12-10">p3</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/plot_brm_avg-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>The average effects‚Äô estimates in this model have higher uncertainty than in the <code>lmerfit</code> model above, explaining why the average regression line‚Äôs CI is also wider.</p>
</section>
<section id="alternative-to-cis" class="level4">
<h4 class="anchored" data-anchor-id="alternative-to-cis">Alternative to CIs</h4>
<p>Instead of showing summaries of the samples from the posterior distribution, one could also plot the entire distribution‚Äìat the risk of overplotting. Overplotting can be avoided by adjusting each regression line‚Äôs transparency with the <code>alpha</code> parameter, resulting in a visually attractive‚Äìmaybe?‚Äìdisplay of the uncertainty in the regression line:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-1_fd71379dca8887cc23ba29c07cc664ec">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">pst <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">posterior_samples</span>(brmfit, <span class="st" style="color: #20794D;">"b"</span>)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;">ggplot</span>(sleepstudy, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> Days, <span class="at" style="color: #657422;">y =</span> Reaction)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">shape =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;">geom_abline</span>(</span>
<span id="cb13-5">    <span class="at" style="color: #657422;">data =</span> pst, <span class="at" style="color: #657422;">alpha =</span> .<span class="dv" style="color: #AD0000;">01</span>, <span class="at" style="color: #657422;">size =</span> .<span class="dv" style="color: #AD0000;">4</span>,</span>
<span id="cb13-6">    <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">intercept =</span> b_Intercept, <span class="at" style="color: #657422;">slope =</span> b_Days)</span>
<span id="cb13-7">  )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="varying-regression-lines-cis" class="level4">
<h4 class="anchored" data-anchor-id="varying-regression-lines-cis">Varying regression lines &amp; CIs</h4>
<p>The best part is, brms‚Äô <code>fitted()</code> also gives regression lines with CIs at the individual level.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/plot_brm_vary_eb6ff23721ab439beb9e0fa6a059b3e5">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">X <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">cbind</span>(sleepstudy[, <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">3</span>], <span class="fu" style="color: #4758AB;">fitted</span>(brmfit)[, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">2</span>]) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as_tibble</span>()</span>
<span id="cb14-2">p2 <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> X, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> Estimate), <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> X, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> Q2<span class="fl" style="color: #AD0000;">.5</span>), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> X, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> Q97<span class="fl" style="color: #AD0000;">.5</span>), <span class="at" style="color: #657422;">lty =</span> <span class="dv" style="color: #AD0000;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/plot_brm_vary-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Working with brms makes it very easy to obtain CIs for regression lines at both levels of analysis.</p>
</section>
<section id="an-alternative-visualization" class="level3">
<h3 class="anchored" data-anchor-id="an-alternative-visualization">An alternative visualization</h3>
<p>It might be useful, especially for model checking purposes, to display not only the fitted values, but also what the model predicts. To display the 95% prediction interval, I use the same procedure, but replace <code>fitted()</code> with <code>predict()</code>:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-2_1abd26b1524d35921cf63bc6d8858e52">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">newavg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">Days =</span> <span class="dv" style="color: #AD0000;">0</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>)</span>
<span id="cb15-2">predavg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">cbind</span>(</span>
<span id="cb15-3">  newavg, </span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;">predict</span>(brmfit, <span class="at" style="color: #657422;">newdata =</span> newavg, <span class="at" style="color: #657422;">re_formula =</span> <span class="cn" style="color: #8f5902;">NA</span>)[, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">2</span>]</span>
<span id="cb15-5">  )</span>
<span id="cb15-6"><span class="fu" style="color: #4758AB;">names</span>(predavg) <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Days"</span>, <span class="st" style="color: #20794D;">"Reaction"</span>, <span class="st" style="color: #20794D;">"lower"</span>, <span class="st" style="color: #20794D;">"upper"</span>)</span>
<span id="cb15-7">p3 <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_ribbon</span>(</span>
<span id="cb15-8">  <span class="at" style="color: #657422;">data =</span> predavg, </span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">ymin =</span> lower, <span class="at" style="color: #657422;">ymax =</span> upper),</span>
<span id="cb15-10">  <span class="at" style="color: #657422;">col =</span> <span class="cn" style="color: #8f5902;">NA</span>, <span class="at" style="color: #657422;">alpha =</span> .<span class="dv" style="color: #AD0000;">2</span></span>
<span id="cb15-11">)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="one-liners" class="level3">
<h3 class="anchored" data-anchor-id="one-liners">One-liners</h3>
<p>brms also has a function <code>conditional_effects()</code> that makes drawing these plots easy. Here is how to draw the average effect (first), and subject-specific effects (latter).</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-3_a9762d5baf5fcb0084d4494d9ecdc556">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;">conditional_effects</span>(brmfit)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;">conditional_effects</span>(</span>
<span id="cb17-2">  brmfit, </span>
<span id="cb17-3">  <span class="at" style="color: #657422;">conditions =</span> <span class="fu" style="color: #4758AB;">distinct</span>(sleepstudy, Subject), </span>
<span id="cb17-4">  <span class="at" style="color: #657422;">re_formula =</span> <span class="cn" style="color: #8f5902;">NULL</span></span>
<span id="cb17-5">)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Working with a matrix of plausible parameter values makes it easier to draw regression lines with confidence intervals. Specifically, the brms package provides easy access to CIs in a multilevel modeling context.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bolgerIntensiveLongitudinalMethods2013" class="csl-entry">
Bolger, Niall, and Jean-Philippe Laurenceau. 2013. <em>Intensive <span>Longitudinal Methods</span>: <span>An Introduction</span> to <span>Diary</span> and <span>Experience Sampling Research</span></em>. <span>New York, NY</span>: <span>Guilford Press</span>. <a href="https://www.intensivelongitudinal.com">https://www.intensivelongitudinal.com</a>.
</div>
<div id="ref-gelmanDataAnalysisUsing2007" class="csl-entry">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data <span>Analysis Using Regression</span> and <span>Multilevel</span>/<span>Hierarchical Models</span></em>. <span>New York, NY</span>: <span>Cambridge University Press</span>. <a href="http://www.stat.columbia.edu/~gelman/arm/">http://www.stat.columbia.edu/~gelman/arm/</a>.
</div>
<div id="ref-korner-nievergeltBayesianDataAnalysis2015" class="csl-entry">
Korner-Nievergelt, Franzi, Tobias Roth, Stefanie von Felten, J√©r√¥me Gu√©lat, Bettina Almasi, and Pius Korner-Nievergelt. 2015. <em>Bayesian <span>Data Analysis</span> in <span>Ecology Using Linear Models</span> with <span>R</span>, <span>BUGS</span>, and <span>Stan</span></em>. <span>Elsevier Science</span>. <a href="https://www.elsevier.com/books/bayesian-data-analysis-in-ecology-using-linear-models-with-r-bugs-and-stan/korner-nievergelt/978-0-12-801370-0">https://www.elsevier.com/books/bayesian-data-analysis-in-ecology-using-linear-models-with-r-bugs-and-stan/korner-nievergelt/978-0-12-801370-0</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{vuorre2016,
  author = {Matti Vuorre},
  title = {Confidence Intervals in Multilevel Models},
  date = {2016-03-06},
  url = {https://sometimesir.com/posts/2016-03-06-multilevel-predictions},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-vuorre2016" class="csl-entry quarto-appendix-citeas">
Matti Vuorre. 2016. <span>‚ÄúConfidence Intervals in Multilevel
Models.‚Äù</span> March 6, 2016. <a href="https://sometimesir.com/posts/2016-03-06-multilevel-predictions">https://sometimesir.com/posts/2016-03-06-multilevel-predictions</a>.
</div></div></section></div> ]]></description>
  <category>statistics</category>
  <category>R</category>
  <category>brms</category>
  <category>tutorial</category>
  <guid>https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index.html</guid>
  <pubDate>Sun, 06 Mar 2016 00:00:00 GMT</pubDate>
  <media:content url="https://sometimesir.com/posts/2016-03-06-multilevel-predictions/index_files/figure-html/fig1and2-1.png" medium="image" type="image/png" height="90" width="144"/>
</item>
</channel>
</rss>
